[
  {
    "objectID": "11_general_framework.html",
    "href": "11_general_framework.html",
    "title": "General framework",
    "section": "",
    "text": "Context and motivation",
    "crumbs": [
      "General framework"
    ]
  },
  {
    "objectID": "11_general_framework.html#research-questions",
    "href": "11_general_framework.html#research-questions",
    "title": "General framework",
    "section": "Research questions",
    "text": "Research questions",
    "crumbs": [
      "General framework"
    ]
  },
  {
    "objectID": "11_general_framework.html#methodological-approach",
    "href": "11_general_framework.html#methodological-approach",
    "title": "General framework",
    "section": "Methodological approach",
    "text": "Methodological approach",
    "crumbs": [
      "General framework"
    ]
  },
  {
    "objectID": "21_soil_data.html",
    "href": "21_soil_data.html",
    "title": "Soil dataset",
    "section": "",
    "text": "Site location\nCode\nmap_data(\"world\") |&gt; \n  subset(region == \"Ivory Coast\") |&gt; \n  ggplot() +\n  geom_polygon(aes(x=long, y = lat), fill = \"white\") + \n  geom_point(data = data_soil, aes(lon, lat, col = site)) +\n  theme(axis.title = element_blank()) +\n  coord_equal()",
    "crumbs": [
      "Soil dataset"
    ]
  },
  {
    "objectID": "21_soil_data.html#site-location",
    "href": "21_soil_data.html#site-location",
    "title": "Soil dataset",
    "section": "Site location",
    "text": "Site location\n\n\nCode\nmap_data(\"world\") |&gt; \n  subset(region == \"Ivory Coast\") |&gt; \n  ggplot() +\n  geom_polygon(aes(x=long, y = lat), fill = \"white\") + \n  geom_point(data = data_soil, aes(lon, lat, col = site)) +\n  theme(axis.title = element_blank()) +\n  coord_equal()",
    "crumbs": [
      "Soil dataset"
    ]
  },
  {
    "objectID": "21_soil_data.html#distribution-of-soil-organic-carbon-stocks",
    "href": "21_soil_data.html#distribution-of-soil-organic-carbon-stocks",
    "title": "Soil dataset",
    "section": "Distribution of soil organic carbon stocks",
    "text": "Distribution of soil organic carbon stocks\n\n\nCode\ndata_soil |&gt; \n  ggplot(aes(x = T_stock)) + \n  geom_histogram() +\n  labs(x = expression(\"Soil organic carbon stocks [ Mg.\"*ha^-1*\" ]\")) +\n  theme_classic()\n\n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_bin()`).",
    "crumbs": [
      "Soil dataset"
    ]
  },
  {
    "objectID": "21_soil_data.html#dataset-size",
    "href": "21_soil_data.html#dataset-size",
    "title": "Soil dataset",
    "section": "Dataset size",
    "text": "Dataset size\n\n\nCode\ndata_soil |&gt; \n  group_by(site) |&gt; \n  summarise(n = n()) |&gt; \n  kable(col.names = c(\"Site\", \"Number of plots\"))\n\n\n\n\n\nSite\nNumber of plots\n\n\n\n\nAnguededou\n1\n\n\nadzope\n17\n\n\nagbo\n18\n\n\nagnibilekrou\n16\n\n\nazaguie\n16\n\n\nbadenou\n17\n\n\nbehiri\n87\n\n\nbiankouma\n16\n\n\nble\n15\n\n\nbonon\n16\n\n\nfoumbou\n17\n\n\nfresco\n16\n\n\ngrand_bereby\n16\n\n\ngueyo\n16\n\n\nguiberoua\n16\n\n\nguiglo\n16\n\n\nht_sassandra\n17\n\n\nirobo\n17\n\n\nmafere\n16\n\n\nmeagui\n16\n\n\nmebifon\n47\n\n\nniegre\n17\n\n\nsan_pedro\n16\n\n\nsoubre\n16\n\n\ntene\n17\n\n\nyaya\n17\n\n\n\n\n\nCode\ndata_soil |&gt; \n  subset(!is.na(present_landuse)) |&gt; \n  group_by(present_landuse) |&gt; \n  summarise(n = n()) |&gt; \n  kable(col.names = c(\"Landuse\", \"Number of plots\"))\n\n\n\n\n\nLanduse\nNumber of plots\n\n\n\n\ncassava\n45\n\n\ncocoa\n211\n\n\nfallow\n184\n\n\nfood_crop\n16\n\n\nforest\n9\n\n\nforetanc\n8\n\n\njvc\n16\n\n\npalm\n8\n\n\nplantation\n1\n\n\nrubber\n12",
    "crumbs": [
      "Soil dataset"
    ]
  },
  {
    "objectID": "31_climate.html",
    "href": "31_climate.html",
    "title": "Climate data",
    "section": "",
    "text": "Code\nlibrary(terra)\nlibrary(tidyverse)\nlibrary(ggcorrplot)\nlibrary(ggfortify)\n\n\nThe climate data was retrieved from Climatologies at high resolution for the earth’s land surface areas (CHELSA; 1981–2010 baseline; 1 km resolution). We used four bioclimatic variables: mean annual air temperature (bio01), maximum temperature of the warmest month (bio05), minimum temperature of the coldest month (bio06), and annual precipitation (bio12). All layers were resampled to 100 m.\nThe values of all Bioclimatic variables are then extracted at the location of all terri4sol plots.\n\n\nCode\n# extract values for all t4s plots\ncoord_stocks &lt;- read.csv(\"data/cache/data_stocks.csv\") |&gt;\n  # project into EPSG:32630\n  vect(crs = \"epsg:4326\") |&gt;\n  terra::project(\"epsg:32630\")\n\nclimate_data &lt;-\n  \"data/01_Data/Environmental_variables/CHELSA_bioclim_1981_2010_100m_CI.tif\" |&gt;\n  rast() |&gt;\n  terra::extract(coord_stocks) |&gt;\n  select(contains(\"bio\")) |&gt;\n  bind_cols(select(as.data.frame(coord_stocks), \"site\", \"plot\")) |&gt;\n  relocate(site, plot)\n\nwrite.csv(climate_data, file = \"data/cache/climate_data.csv\", row.names = FALSE)\n\n\nThe following plots have NAs in at least one Bioclim variable.\n\n\nCode\nclimate_data |&gt;\n  filter(if_any(contains(\"bio\"), is.na)) |&gt;\n  relocate(site, plot)\n\n\n     site plot bio01 bio05 bio06 bio12\n1 adzopeN   15    NA    NA    NA    NA\n2 adzopeN   21    NA    NA    NA    NA\n3 adzopeN   48    NA    NA    NA    NA\n4 adzopeN   49    NA    NA    NA    NA\n5 adzopeN   50    NA    NA    NA    NA\n6 adzopeN   51    NA    NA    NA    NA\n7 adzopeN   68    NA    NA    NA    NA\n8 adzopeN   74    NA    NA    NA    NA\n\n\nBelow is the result of a Principal Component Analysis with all bioclimatic variables.\n\n\nCode\ndata_pca &lt;- climate_data |&gt;\n  filter(!if_any(everything(), is.na))\n\ndata_pca |&gt;\n  select(contains(\"bio\")) |&gt;\n  prcomp(scale = TRUE) |&gt;\n  autoplot(\n    loadings = TRUE, loadings.label = TRUE,\n    data = data_pca, colour = \"site\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nWe can also plot the pairwise correlation of all climate variables.\n\n\nCode\nclimate_data |&gt;\n  select(contains(\"bio\")) |&gt;\n  drop_na() |&gt;\n  cor() |&gt;\n  ggcorrplot(type = \"upper\", lab = TRUE)",
    "crumbs": [
      "Ancillary data",
      "Climate data"
    ]
  },
  {
    "objectID": "32_soilgrids.html",
    "href": "32_soilgrids.html",
    "title": "Soilgrids data",
    "section": "",
    "text": "Code\nlibrary(terra)\nlibrary(gdalUtilities)\nlibrary(tidyverse)\nlibrary(ggcorrplot)\nlibrary(ggfortify)\n\n\nThe Soilgrids data was retrieved from the ISRIC website, using SoilGrids 2.0 (Poggio et al. 2021). Variables codes are described here.\n\n\nCode\n# function to download and crop CHELSA data\ndl_soilgrids &lt;- function(\n  var = \"cec\",\n  depth = \"0-5cm\",\n  stat = \"mean\",\n  dir_local = \"data/download/ISRIC\",\n  box = c(-9, -2, 4, 11)\n) {\n  # project bounding box into IGH\n  ext_vect &lt;- terra::as.polygons(terra::ext(box), crs = \"EPSG:4326\")\n  igh &lt;- \"+proj=igh +lat_0=0 +lon_0=0 +datum=WGS84 +units=m +no_defs\"\n  ext_igh &lt;- terra::ext(terra::project(ext_vect, igh))\n  bb &lt;- c(ext_igh$xmin, ext_igh$ymax, ext_igh$xmax, ext_igh$ymin)\n\n  # create url and file name\n  sg_url &lt;- \"/vsicurl/https://files.isric.org/soilgrids/latest/data/\"\n  datos &lt;- paste0(var, \"/\", var, \"_\", depth, \"_\", stat, \".vrt\")\n  file &lt;- paste0(\"data/download/ISRIC/\", var, \"_\", depth, \"_\", stat, \".tif\")\n\n  # download from ISRIC site\n  if (!file.exists(file)) {\n    gdalUtilities::gdal_translate(\n      paste0(sg_url, datos),\n      file,\n      tr = c(250, 250),\n      projwin = bb,\n      projwin_srs = igh\n    )\n  }\n}\n\nif (!dir.exists(\"data/download/ISRIC\")) dir.create(\"data/download/ISRIC\")\n\nfor (v in c(\"bdod\", \"cec\", \"cfvo\", \"clay\",\n            \"nitrogen\", \"phh2o\", \"sand\", \"silt\")) {\n  dl_soilgrids(\n    var = v,\n    depth = \"0-5cm\",\n    stat = \"mean\",\n    dir_local = \"data/download/ISRIC\",\n    box = c(-9, -2, 4, 11)\n  )\n}\n\n\nThe values of SoilGrids variables (for now, at 0-5 cm depth) are then extracted at the location of all terri4sol plots.\n\n\nCode\n# extract values for all t4s plots\ndata_stocks &lt;- read.csv(\"data/cache/data_stocks.csv\")\n\nsoilgrids_data &lt;-\n  list.files(\"data/download/ISRIC\", pattern = \"tif$\", full.names = TRUE) |&gt;\n  rast() |&gt;\n  project(\"EPSG: 4326\") |&gt;\n  terra::extract(data_stocks[, c(\"lon\", \"lat\")]) |&gt;\n  rename_with(~ gsub(pattern = \"_mean\", replacement = \"\", x = .x)) |&gt;\n  select(contains(\"cm\")) |&gt;\n  bind_cols(data_stocks[, c(\"site\", \"plot\")]) |&gt;\n  relocate(site, plot)\n\nwrite.csv(soilgrids_data,\n          file = \"data/cache/soilgrids_data.csv\",\n          row.names = FALSE)\n\n\nThe following plots have NAs in at least one Soilgrids variable.\n\n\nCode\nsoilgrids_data |&gt;\n  filter(if_any(contains(\"cm\"), is.na)) |&gt;\n  relocate(site, plot)\n\n\n           site plot bdod_0-5cm cec_0-5cm cfvo_0-5cm clay_0-5cm nitrogen_0-5cm\n1       adzopeN   15         NA        NA         NA         NA             NA\n2       adzopeN   21         NA        NA         NA         NA             NA\n3       adzopeN   48         NA        NA         NA         NA             NA\n4       adzopeN   49         NA        NA         NA         NA             NA\n5       adzopeN   50         NA        NA         NA         NA             NA\n6       adzopeN   51         NA        NA         NA         NA             NA\n7       adzopeN   68         NA        NA         NA         NA             NA\n8       adzopeN   74         NA        NA         NA         NA             NA\n9  agnibilekrou   12         NA  222.4667   222.3977   197.9799       338.7231\n10 agnibilekrou   13         NA  222.4667   222.3977   197.9799       338.7231\n11 agnibilekrou   14         NA  262.8052   219.2761   198.1559       380.7717\n12 agnibilekrou    3         NA  219.7961   212.8130   211.8463       370.8293\n13        bonon   14         NA        NA         NA         NA             NA\n   phh2o_0-5cm sand_0-5cm silt_0-5cm\n1           NA         NA         NA\n2           NA         NA         NA\n3           NA         NA         NA\n4           NA         NA         NA\n5           NA         NA         NA\n6           NA         NA         NA\n7           NA         NA         NA\n8           NA         NA         NA\n9     59.26054   513.8930   287.4169\n10    59.26054   513.8930   287.4169\n11    59.34255   486.8322   315.0118\n12    59.19337   515.0866   273.8551\n13          NA         NA         NA\n\n\nBelow is the result of a Principal Component Analysis with all Soilgrids variables.\n\n\nCode\ndata_pca &lt;- soilgrids_data |&gt;\n  filter(!if_any(everything(), is.na))\n\ndata_pca |&gt;\n  select(contains(\"cm\")) |&gt;\n  prcomp(scale = TRUE) |&gt;\n  autoplot(\n    loadings = TRUE, loadings.label = TRUE,\n    data = data_pca, colour = \"site\"\n  ) +\n  theme_minimal()\n\n\nWarning: `aes_string()` was deprecated in ggplot2 3.0.0.\nℹ Please use tidy evaluation idioms with `aes()`.\nℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\nℹ The deprecated feature was likely used in the ggfortify package.\n  Please report the issue at &lt;https://github.com/sinhrks/ggfortify/issues&gt;.\n\n\n\n\n\n\n\n\n\nWe can also plot the pairwise correlation of all Soilgrids variables.\n\n\nCode\nsoilgrids_data |&gt;\n  select(contains(\"cm\")) |&gt;\n  filter(!if_any(everything(), is.na)) |&gt;\n  cor() |&gt;\n  ggcorrplot()\n\n\n\n\n\n\n\n\n\n\n\n\n\nPoggio, Laura, Luis M. de Sousa, Niels H. Batjes, Gerard B. M. Heuvelink, Bas Kempen, Eloi Ribeiro, and David Rossiter. 2021. “SoilGrids 2.0: producing soil information for the globe with quantified spatial uncertainty.” SOIL 7 (1): 217–40. https://doi.org/10.5194/soil-7-217-2021.",
    "crumbs": [
      "Ancillary data",
      "Soilgrids data"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Soil Organic Carbon map of Cote d’Ivoire",
    "section": "",
    "text": "Introduction\nt4_soc_map is part of the terri4sol project.\nAll t4_soc_map analyses rely on the quarto documents (files.qmd) that can be run with R and associated environment defined with renv.",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "index.html#project",
    "href": "index.html#project",
    "title": "Soil Organic Carbon map of Cote d’Ivoire",
    "section": "Project",
    "text": "Project\nt4_soc_map includes:\n\nAnalyse of the data with associated documentation and figures:\n\nReproducible analyses in files.qmd\nResulting pages in docs/\nDocument structure definition in _quarto.yml\n\nData in data/\nR scripts with functions in r/\nIntermediary files in outputs/\nFigures in figures/\nR environment definition with renv in renv/ and renv/lock\nGit and GitHub files (.gitignore , .github/)\nProject documentation (README.qmd , README.md , LICENSE)",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "index.html#help",
    "href": "index.html#help",
    "title": "Soil Organic Carbon map of Cote d’Ivoire",
    "section": "Help",
    "text": "Help\nPlease preferentially create an issue on GitHub for any questions, bugs or help needed regarding t4_soc_map: https://github.com/cpiponiot/t4s_soc_map/issues. However, you can contact us by email through people in the core group (see below).",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "index.html#core-group",
    "href": "index.html#core-group",
    "title": "Soil Organic Carbon map of Cote d’Ivoire",
    "section": "Core group",
    "text": "Core group\n\nBienvenu H. K. Amani (bienvenuh.amani@gmail.com)\nCamille Piponiot (camille.piponiot-laroche@cirad.fr)\nBlandine Ahou Koffi\nEvans Ehouman\nClovis Grinand\nBeatriz Bellon\nLarissa Houphouet\nBruno Herault",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "41_variable_selection.html",
    "href": "41_variable_selection.html",
    "title": "Variable selection",
    "section": "",
    "text": "RandomForest without variable selection\nA Random Forest (RF) model was implemented using the ranger package in R to predict soil organic carbon stock from environmental and soil covariates.\nCode\nformula_soc_all &lt;- colnames(data_all) %&gt;%\n  setdiff(c(\"site\", \"plot\", \"lon\", \"lat\", \"T_stock\")) %&gt;%\n  paste(collapse = \" + \") %&gt;% paste(\"T_stock ~\", .) %&gt;%\n  as.formula()\ntraining_index &lt;- lapply(unique(data_all$site), function(s) which(data_all$site != s))\nrf_all &lt;- train(\n  form = formula_soc_all,\n  data = data_all,\n  method = \"rf\",\n  metric = \"RMSE\",\n  trControl = trainControl(method = \"cv\", index = training_index),\n  ntree = 500, importance = TRUE\n)\nsave(rf_all, file = \"data/cache/models/rf_all.rda\")\nModel performance was evaluated with a leave-one-site-out cross-validation, which yielded the following metrics:\nRMSE: 13.19634 \nR²: 0.07496982",
    "crumbs": [
      "Methodological choices",
      "Variable selection"
    ]
  },
  {
    "objectID": "41_variable_selection.html#based-on-forward-feature-selection-ffs",
    "href": "41_variable_selection.html#based-on-forward-feature-selection-ffs",
    "title": "Variable selection",
    "section": "Based on Forward Feature Selection (FFS)",
    "text": "Based on Forward Feature Selection (FFS)\nThe Forward Feature Selection (FFS) method, applied via the ffs function, is a variable selection technique used in machine learning and statistics to identify the subsets of variables (features) most relevant to the construction of a predictive model.\nHow Forward Feature Selection (FFS) works:\n\nInitialization: The method starts with a simple model, generally without any explanatory variables (or with only the constant in the case of regression).\nProgressive addition of variables: At each iteration, the method examines the addition of each variable not yet selected to the current model. The variable that most improves model performance, according to a specific criterion (e.g. increasing R², reducing mean squared error, etc.), is added to the model.\nValidation : Model performance is often validated at each stage using a cross-validation technique to avoid overlearning (overfitting).\nStop criterion: The process continues until there is no further significant improvement in model performance by adding new variables. A performance threshold can be predefined to determine when to stop adding variables.\nFinal result: At the end of the process, the model retains the variables that have been selected over the iterations as the most important for prediction.",
    "crumbs": [
      "RandomForest model",
      "Variable selection"
    ]
  },
  {
    "objectID": "43_rf_model_calibration.html",
    "href": "43_rf_model_calibration.html",
    "title": "Random forest model",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(usdm)\n\n\n\nPartition data by site\n\n\nCode\ndata &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\")) \n\n# partition data in train/validation\n# randomly select 20% of sites for validation\nvalidation_sites &lt;- data %&gt;%\n  group_by(site) %&gt;%\n  summarise(type = c(\"cal\", \"val\")[1+rbinom(1, 1, 0.2)])\n\ndata &lt;- data %&gt;%\n  drop_na() %&gt;%\n  merge(validation_sites)\n\n\n\n\nAll variables\n\n\nCode\nrf_nosel &lt;- data |&gt; \n  select(!contains(\"plot\"), - site, -type, -lon, -lat, -T_stock) |&gt; \n  randomForest(\n    data$T_stock,\n    subset = (data$type == \"cal\"),\n    ntree=500,\n    importance=TRUE\n  )\n\n\n\n\nCode\nimportance_nosel &lt;- importance(rf_nosel, type=1) |&gt; \n  as.data.frame() |&gt; \n  arrange(`%IncMSE`)\nimportance_nosel$variable &lt;- rownames(importance_nosel)\n\nimportance_nosel |&gt; ggplot(\n    aes(x = variable, y = `%IncMSE`, fill = `%IncMSE`)) +\n  geom_bar(stat = \"identity\") +\n  coord_flip() +\n  xlab(\"Variables\") +\n  ylab(\"Increase in OOB Measn Square Error (%)\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n\nOnly spatial variables - Prior variable selection based on VIF\n\n\nCode\nall_vif &lt;- data |&gt; \n   select(contains(\"bio\"), contains(\"cm\")) |&gt; \n  vifstep(th=10)\n\nrf_spat_vif &lt;- data |&gt; \n  select(all_vif@results$Variables) |&gt; \n  randomForest(\n    data$T_stock,\n    subset = (data$type == \"cal\"),\n    ntree=500,\n    importance=TRUE\n  )\n\n\n\n\nCode\nimportance_spat_vif &lt;- importance(rf_spat_vif, type=1) |&gt; \n  as.data.frame() |&gt; \n  arrange(`%IncMSE`)\nimportance_spat_vif$variable &lt;- rownames(importance_spat_vif)\n\nimportance_spat_vif |&gt; ggplot(\n    aes(x = variable, y = `%IncMSE`, fill = `%IncMSE`)) +\n  geom_bar(stat = \"identity\") +\n  coord_flip() +\n  xlab(\"Variables\") +\n  ylab(\"Mean decrease in accuracy (%)\") +\n  theme_minimal()",
    "crumbs": [
      "RandomForest model",
      "Random forest model"
    ]
  },
  {
    "objectID": "21_prepare_raw_data.html",
    "href": "21_prepare_raw_data.html",
    "title": "Open and prepare the raw dataset",
    "section": "",
    "text": "A summary of the data from the terri4sol project is presented below.\n\n\nCode\ndata_t4s &lt;- read.csv(\"data/soil_0.2.6.csv\")\nsummary(data_t4s)\n\n\n     site               plot               depth         sampleID        \n Length:2256        Length:2256        Min.   :1.000   Length:2256       \n Class :character   Class :character   1st Qu.:1.000   Class :character  \n Mode  :character   Mode  :character   Median :2.000   Mode  :character  \n                                       Mean   :1.998                     \n                                       3rd Qu.:3.000                     \n                                       Max.   :3.000                     \n                                       NA's   :2                         \n       C                N            bulk_density_g_cm3 coarse_fraction  \n Min.   :0.1020   Min.   :-0.03744   Min.   :0.1148     Min.   :0.00000  \n 1st Qu.:0.7046   1st Qu.: 0.06761   1st Qu.:1.3798     1st Qu.:0.01504  \n Median :1.0512   Median : 0.09187   Median :1.5568     Median :0.14139  \n Mean   :1.2960   Mean   : 0.11039   Mean   :1.5415     Mean   :0.21625  \n 3rd Qu.:1.6751   3rd Qu.: 0.13708   3rd Qu.:1.7100     3rd Qu.:0.37532  \n Max.   :6.6624   Max.   : 0.67775   Max.   :2.6440     Max.   :0.87308  \n NA's   :2        NA's   :2          NA's   :156        NA's   :135      \n fine_fraction          K                Ca              Mg        \n Min.   :0.1269   Min.   :0.0690   Min.   :0.660   Min.   :0.1905  \n 1st Qu.:0.6247   1st Qu.:0.0970   1st Qu.:1.031   1st Qu.:0.4178  \n Median :0.8586   Median :0.1130   Median :1.160   Median :0.4820  \n Mean   :0.7838   Mean   :0.1169   Mean   :1.201   Mean   :0.5998  \n 3rd Qu.:0.9850   3rd Qu.:0.1270   3rd Qu.:1.314   3rd Qu.:0.6943  \n Max.   :1.0000   Max.   :0.2380   Max.   :2.689   Max.   :1.5040  \n NA's   :135      NA's   :2146     NA's   :2146    NA's   :2146    \n       Na         \n Min.   :0.06325  \n 1st Qu.:0.08892  \n Median :0.10358  \n Mean   :0.10718  \n 3rd Qu.:0.11642  \n Max.   :0.21817  \n NA's   :2146     \n\n\nSoil organic carbon stocks were estimated as\n\\[ stock = C \\cdot (\\Delta d \\cdot area) \\cdot fine \\cdot bd\\]\nwhere \\(C\\) is the soil organic carbon content, \\(\\Delta d\\) is the measurement depth (0.1 m), \\(area\\) is the standardisation area (1 ha = \\(10^4\\) m), \\(fine\\) is the fine fraction of the soil, and \\(bd\\) is the bulk density of the fine fraction (in Mg m\\(^3\\)).\n\n\nCode\ndata_t4s &lt;- data_t4s |&gt;\n  mutate(stock = C / 100 * 1e3 * fine_fraction * bulk_density_g_cm3)\n\n\nWe also added data from the RévaTéné project that collected SOC data in the Téné forest plots.\n\n\nCode\ndata_tene &lt;- read_excel(\"data/BdD_Mathus_TENE.xls\", 2) |&gt;\n  mutate(T_stock = `CCOS_0-30cm` / 100 *\n           (`Dapp_0-10cm` + `Dapp_10-20cm` + `Dapp_20-30cm`) / 3 *\n           (1 - `%EG_0-30cm`) * 1e3) |&gt;\n  mutate(site = \"tene\", plot = SUBPLOT) |&gt;\n  separate(SUBPLOT, c(\"pl\", \"sub\")) |&gt;\n  reframe(get_tene_coords(pl, sub), across()) |&gt;\n  select(site, plot, lon, lat, T_stock)\n\n\nLinking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE\n\n\nWarning: There was 1 warning in `reframe()`.\nℹ In argument: `across()`.\nCaused by warning:\n! Using `across()` without supplying `.cols` was deprecated in dplyr 1.1.0.\nℹ Please supply `.cols` instead.\n\n\nWe then sum the carbon stocks over all depths at each site to get the total carbon stocks, and save the results.\n\n\nCode\nread.csv(\"data/plot_0.2.6.csv\") |&gt;\n  # correct plot coordinates\n  mutate(lonc = ifelse(lon &gt; 0, lat, lon), latc = ifelse(lat &lt; 0, lon, lat)) |&gt;\n  select(site, plot, lonc, latc) |&gt;\n  rename(lon = lonc, lat = latc) |&gt;\n  merge(data_t4s) |&gt;\n  group_by(site, plot, lon, lat) |&gt;\n  summarise(T_stock = sum(stock), .groups = \"drop\") |&gt;\n  bind_rows(data_tene) |&gt;\n  write.csv(\"data/cache/data_stocks.csv\", row.names = FALSE)",
    "crumbs": [
      "terri4sol soil database",
      "Open and prepare the raw dataset"
    ]
  },
  {
    "objectID": "22_check_errors.html",
    "href": "22_check_errors.html",
    "title": "Error checks",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(knitr)\n\n\nThe following sites have missing coordinates:\n\n\nCode\nread.csv(\"data/plot_0.2.6.csv\") |&gt;\n  subset(is.na(lon) | is.na(lat)) |&gt;\n  group_by(site) |&gt;\n  summarise(n()) |&gt;\n  kable(col.names = c(\"site\", \"number of plots\"))\n\n\n\n\n\nsite\nnumber of plots\n\n\n\n\nadzopeN\n8\n\n\nmebifon\n1\n\n\n\n\n\nPlot information is missing in the following sites:\n\n\nCode\nread.csv(\"data/plot_0.2.6.csv\") |&gt;\n  subset(is.na(plot)) |&gt;\n  group_by(site) |&gt;\n  summarise(n()) |&gt;\n  kable(col.names = c(\"site\", \"number of plots\"))\n\n\n\n\n\nsite\nnumber of plots\n\n\n\n\nmebifon\n5\n\n\n\n\n\nPlot area varies as follows (in log-scale):\n\n\nCode\nread.csv(\"data/plot_0.2.6.csv\") |&gt;\n  ggplot(aes(x = plot_area)) +\n  geom_histogram() +\n  labs(x = \"Plot area (ha)\") +\n  theme_classic() +\n  scale_x_log10()\n\n\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\nWarning: Removed 122 rows containing non-finite outside the scale range\n(`stat_bin()`).",
    "crumbs": [
      "terri4sol soil database",
      "Error checks"
    ]
  },
  {
    "objectID": "23_visualize_data.html",
    "href": "23_visualize_data.html",
    "title": "Soil dataset",
    "section": "",
    "text": "Site location\nCode\nloc_plots &lt;- read.csv(\"data/cache/data_stocks.csv\") |&gt;\n  select(site, plot, lat, lon) |&gt;\n  drop_na()\nleaflet() |&gt;\n  addProviderTiles(providers$Esri.WorldImagery) |&gt;\n  addMarkers(\n    lng = loc_plots$lon, lat = loc_plots$lat,\n    label = paste(loc_plots$site, loc_plots$plot)\n  )",
    "crumbs": [
      "terri4sol soil database",
      "Soil dataset"
    ]
  },
  {
    "objectID": "23_visualize_data.html#dataset-size",
    "href": "23_visualize_data.html#dataset-size",
    "title": "Soil dataset",
    "section": "Dataset size",
    "text": "Dataset size\n\n\nCode\nread.csv(\"data/cache/data_stocks.csv\") |&gt;\n  group_by(site) |&gt;\n  summarise(n = n()) |&gt;\n  kable(col.names = c(\"Site\", \"Number of plots\"))\n\n\n\n\n\nSite\nNumber of plots\n\n\n\n\nadzope\n16\n\n\nadzopeN\n115\n\n\nagbo\n19\n\n\nagnibilekrou\n16\n\n\nazaguie\n16\n\n\nbadenou\n21\n\n\nbehiri\n87\n\n\nbiankouma\n16\n\n\nble\n16\n\n\nbonon\n16\n\n\nfoumbou\n20\n\n\nfresco\n16\n\n\ngrand_bereby\n16\n\n\ngueyo\n16\n\n\nguiberoua\n16\n\n\nguiglo\n16\n\n\nht_sassandra\n20\n\n\nirobo\n20\n\n\nmafere\n16\n\n\nmeagui\n16\n\n\nmebifon\n99\n\n\nniegre\n20\n\n\nsan_pedro\n16\n\n\nsoubre\n16\n\n\ntai\n7\n\n\ntene\n119\n\n\ntene_oume\n8\n\n\nyaya\n20\n\n\n\n\n\nCode\nread.csv(\"data/plot_0.2.6.csv\") |&gt;\n  subset(!is.na(present_landuse)) |&gt;\n  group_by(present_landuse) |&gt;\n  summarise(n = n()) |&gt;\n  # add revatene data\n  mutate(n = n + ifelse(present_landuse == \"foretanc\", 100, 0)) |&gt;\n  kable(col.names = c(\"Landuse\", \"Number of plots\"))\n\n\n\n\n\nLanduse\nNumber of plots\n\n\n\n\ncassava\n45\n\n\ncocoa\n227\n\n\ndist_for\n7\n\n\nfallow\n191\n\n\nfood_crop\n16\n\n\nforest\n14\n\n\nforetanc\n130\n\n\njvc\n24\n\n\nold_mining\n8\n\n\nothers\n2\n\n\npalm\n8\n\n\nprim_for\n8\n\n\nrubber\n32\n\n\nsec_for\n117\n\n\ntrees plantation\n5",
    "crumbs": [
      "terri4sol soil database",
      "Soil dataset"
    ]
  },
  {
    "objectID": "23_visualize_data.html#distribution-of-soil-organic-carbon-stocks",
    "href": "23_visualize_data.html#distribution-of-soil-organic-carbon-stocks",
    "title": "Soil dataset",
    "section": "Distribution of soil organic carbon stocks",
    "text": "Distribution of soil organic carbon stocks\n\n\nCode\nread.csv(\"data/cache/data_stocks.csv\") |&gt;\n  ggplot(aes(x = T_stock)) +\n  geom_histogram() +\n  labs(x = expression(\"Soil organic carbon stocks [ Mg.\" * ha^-1 * \" ]\")) +\n  theme_classic()\n\n\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\nWarning: Removed 16 rows containing non-finite outside the scale range\n(`stat_bin()`).",
    "crumbs": [
      "terri4sol soil database",
      "Soil dataset"
    ]
  },
  {
    "objectID": "42_all_variables.html",
    "href": "42_all_variables.html",
    "title": "RF without variable selection",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(usdm)\n\n\nWe first randomly partition the data by site, keeping 20% of sites for validation.\n\n\nCode\ndata &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\"))  %&gt;%\n  drop_na()\n\n# partition data in train/validation\n# randomly select 20% of sites for validation\nvalidation_sites &lt;- data %&gt;%\n  group_by(site) %&gt;%\n  summarise(type = c(\"cal\", \"val\")[1+rbinom(1, 1, 0.2)])\n\ndata &lt;- data %&gt;%\n  merge(validation_sites)\n\n\n\n\nCode\nrf_nosel &lt;- data |&gt; \n  select(!contains(\"plot\"), - site, -type, -lon, -lat, -T_stock) |&gt; \n  randomForest(\n    data$T_stock,\n    subset = (data$type == \"cal\"),\n    ntree=500,\n    importance=TRUE\n  )\n\n\nThe importance of all variables in the final model is represented below.\n\n\nCode\ndata_groups &lt;- read.csv(\"data/cache/var_selection.csv\")\n\nimportance_nosel &lt;- importance(rf_nosel, type=1) |&gt; \n  as.data.frame() \nimportance_nosel$variable &lt;- rownames(importance_nosel)\n\nimportance_nosel |&gt; \n  merge(data_groups) |&gt; \n  ggplot(aes(x = reorder(variable, `%IncMSE`), y = `%IncMSE`, fill = group)) +\n  geom_bar(stat = \"identity\") +\n  coord_flip() +\n  xlab(\"Variables\") +\n  ylab(\"Increase in OOB Measn Square Error (%)\") +\n  theme_minimal()",
    "crumbs": [
      "RandomForest model",
      "RF without variable selection"
    ]
  },
  {
    "objectID": "43_rf_comparison.html",
    "href": "43_rf_comparison.html",
    "title": "Comparison of Random forest models results",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(usdm)",
    "crumbs": [
      "RandomForest model",
      "Comparison of Random forest models results"
    ]
  },
  {
    "objectID": "44_predictions.html",
    "href": "44_predictions.html",
    "title": "SOC stocks prediction",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(usdm)\nlibrary(exactextractr)\n\n\nPredictors must be at the same resolution (here the coarsest resolution: 1 km).\n\n\nCode\nchelsa &lt;- \n  list.files(\"data/download/CHELSA\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast()\nnames(chelsa) &lt;- list.files(\"data/download/CHELSA\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"CHELSA_|_1981-2010_V.2.1.tif\", replacement = \"\")\n\nsoilgrids &lt;- \n  list.files(\"data/download/ISRIC\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast() |&gt; \n  project(\"EPSG: 4326\") |&gt; \n  lapply(function(x) exact_resample(x, chelsa[[1]], 'mean')) |&gt; \n  rast()\nnames(soilgrids) &lt;- list.files(\"data/download/ISRIC\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"_mean.tif\", replacement = \"\")\n\nas.data.frame(chelsa, xy = TRUE) |&gt; \n  inner_join(as.data.frame(soilgrids, xy = TRUE)) |&gt; \n  write.csv(\"data/cache/data_vars.csv\", row.names = FALSE)\n\n\n\n\nCode\ndata &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\"))  %&gt;%\n  drop_na()\n\n# partition data in train/validation\n# randomly select 20% of sites for validation\nvalidation_sites &lt;- data %&gt;%\n  group_by(site) %&gt;%\n  summarise(type = c(\"cal\", \"val\")[1+rbinom(1, 1, 0.2)])\n\ndata &lt;- data %&gt;%\n  merge(validation_sites)\n\n\n\n\nCode\nrf_nosel &lt;- data |&gt; \n  select(!contains(\"plot\"), - site, -type, -lon, -lat, -T_stock) |&gt; \n  randomForest(\n    data$T_stock,\n    subset = (data$type == \"cal\"),\n    ntree=500,\n    importance=TRUE\n  )\n\n\n\n\nCode\ndata_vars &lt;- read.csv(\"data/cache/data_vars.csv\") |&gt; \n  drop_na()\ndata_vars$T_stock &lt;- predict(rf_nosel, data_vars)\n\nggplot(data_vars, aes(x, y, fill = T_stock)) +\n  geom_raster() +\n  coord_equal()+\n  labs(x = NULL, y = NULL) +\n  scale_fill_viridis_c(name = \"Stocks de C\\nprédits\\n(Mg/ha)\", option = \"D\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\nggsave(\"D:/projets-cirad/terri4sol/presentations/carte_c_preds.png\")\n\n\nSaving 7 x 5 in image",
    "crumbs": [
      "RandomForest model",
      "SOC stocks prediction"
    ]
  },
  {
    "objectID": "33_tmf.html",
    "href": "33_tmf.html",
    "title": "TMF data",
    "section": "",
    "text": "Comparison of TMF and field-based plot classification\nWe used data from the Tropical Moist Forests (TMF) product, which is based on Landsat images (Vancutsem et al. 2021), to estimate the time since deforestation and the age of secondary forests. These classify tropical areas annually as follows: (i) undisturbed forests, (ii) disturbed forests, (iii) deforested areas, (iv) regrowing forests, (v) water, and (vi) other.\nWe estimated the age of secondary forests in 2022 as the number of years a pixel of regrowing forest in 2022 had continuously been classified as such. We estimated the time since deforestation as the time since a pixel that was classified as undisturbed or disturbed forest in 1990 (i.e. the first year of the TMF time series) had changed to another class.\nCode\ntmf2022 &lt;- rast(\"data/download/TMF/JRC_TMF_AnnualChange_v1_2022_RCI.tif\")\nplots &lt;- read.csv(\"data/plot_0.2.6.csv\")\nplots$tmf_class &lt;-\n  c(\"Undisturbed\", \"Degraded\", \"Deforested\", \"Regrowth\", \"Water\", \"Other\")[\n    terra::extract(tmf2022, plots[, c(\"lon\", \"lat\")])$Dec2022\n  ]\nplots |&gt;\n  with(table(tmf_class, present_landuse))\n\n\n             present_landuse\ntmf_class     cassava cocoa dist_for fallow food_crop forest foretanc jvc\n  Deforested       14    53        0     19         7      0        0   7\n  Degraded          3    43        1     60         0      4        5  12\n  Other            24    69        0     41         9      5        2   0\n  Regrowth          3    43        0     17         0      2        0   1\n  Undisturbed       1    19        6     22         0      3       14   4\n  Water             0     0        0      0         0      0        0   0\n             present_landuse\ntmf_class     old_mining others palm prim_for rubber sec_for trees plantation\n  Deforested           0      0    1        0      8       0                0\n  Degraded             4      0    0        1     14      52                0\n  Other                0      1    5        0      2       3                5\n  Regrowth             1      0    2        0      3      38                0\n  Undisturbed          3      0    0        6      5      22                0\n  Water                0      1    0        1      0       2                0",
    "crumbs": [
      "Ancillary data",
      "TMF data"
    ]
  },
  {
    "objectID": "33_tmf.html#position-of-forestfallow-measurements-compared-to-tmf-data",
    "href": "33_tmf.html#position-of-forestfallow-measurements-compared-to-tmf-data",
    "title": "TMF data",
    "section": "",
    "text": "Vancutsem, Christelle, Frédéric Achard, J-F Pekel, Ghislain Vieilledent, Silvia Carboni, Dario Simonetti, Javier Gallego, Luiz EOC Aragao, and Robert Nasi. 2021. “Long-Term (1990–2019) Monitoring of Forest Cover Changes in the Humid Tropics.” Science Advances 7 (10): eabe1603.",
    "crumbs": [
      "Ancillary data",
      "TMF data"
    ]
  },
  {
    "objectID": "33_tmf.html#comparison-of-tmf-and-field-based-plot-classification",
    "href": "33_tmf.html#comparison-of-tmf-and-field-based-plot-classification",
    "title": "TMF data",
    "section": "",
    "text": "Vancutsem, Christelle, Frédéric Achard, J-F Pekel, Ghislain Vieilledent, Silvia Carboni, Dario Simonetti, Javier Gallego, Luiz EOC Aragao, and Robert Nasi. 2021. “Long-Term (1990–2019) Monitoring of Forest Cover Changes in the Humid Tropics.” Science Advances 7 (10): eabe1603.",
    "crumbs": [
      "Ancillary data",
      "TMF data"
    ]
  },
  {
    "objectID": "43_var_comparison.html",
    "href": "43_var_comparison.html",
    "title": "Comparison of Random forest models results",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(usdm)\nlibrary(caret)\nlibrary(knitr)\n\n\n\n\nCode\ndata &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\")) %&gt;% \n  drop_na() \n\n# partition data in train/validation\n# randomly select 20% of sites for validation\nvalidation_sites &lt;- data %&gt;%\n  group_by(site) %&gt;%\n  summarise(type = c(\"cal\", \"val\")[1+rbinom(1, 1, 0.2)])\n\ndata &lt;- data %&gt;%\n  merge(validation_sites)\n\n\n\ndata_groups &lt;- read.csv(\"data/cache/var_selection.csv\")\n\n\n\nModel with variable selection\n\n\nCode\n# Définir la stratégie de validation croisée répétée\nvalid_control &lt;- trainControl(method = \"repeatedcv\", number = 5, repeats = 3)\n\n# Créer le jeu de données d'entraînement (calibration)\ntrain_data &lt;- data %&gt;% \n  filter(type == \"cal\") %&gt;% \n  select(all_of(data_groups$variable[data_groups$ffs2]), T_stock)\n\n# Créer les objets x (variables explicatives) et y (variable réponse)\nx &lt;- train_data %&gt;% select(-T_stock)\ny &lt;- train_data$T_stock\n\n# Entraîner le modèle Random Forest avec caret\ncaret_rf_model &lt;- train(\n  x = x,\n  y = y,\n  method = \"rf\",\n  metric = \"Rsquared\",\n  trControl = valid_control,\n  importance = TRUE,\n  ntree = 500\n)\n\n# Afficher les résultats\nkable(caret_rf_model$results, digits = 3, caption = \"Random Forest Model Performance with Variable Selection\")\n\n\n\nRandom Forest Model Performance with Variable Selection\n\n\nmtry\nRMSE\nRsquared\nMAE\nRMSESD\nRsquaredSD\nMAESD\n\n\n\n\n2\n11.689\n0.404\n8.812\n1.323\n0.098\n0.752\n\n\n3\n11.732\n0.401\n8.850\n1.365\n0.098\n0.746\n\n\n4\n11.751\n0.400\n8.878\n1.367\n0.102\n0.755\n\n\n\n\n\n\n\nModel with all variables\n\n\nCode\n# Définir la stratégie de validation croisée répétée\nvalid_control &lt;- trainControl(method = \"repeatedcv\", number = 5, repeats = 3)\n\n# Créer le jeu de données d'entraînement (calibration) avec les mêmes variables que rf_nosel\ntrain_data &lt;- data %&gt;%\n  filter(type == \"cal\") %&gt;%\n  select(!contains(\"plot\"), -site, -type, -lon, -lat, -T_stock, T_stock)  # T_stock réajouté à la fin\n\n# Créer les objets x (variables explicatives) et y (variable réponse)\nx &lt;- train_data %&gt;% select(-T_stock)\ny &lt;- train_data$T_stock\n\n# Entraîner le modèle Random Forest avec caret\ncaret_rf_nosel &lt;- train(\n  x = x,\n  y = y,\n  method = \"rf\",\n  metric = \"Rsquared\",\n  trControl = valid_control,\n  importance = TRUE,\n  ntree = 500\n)\n\nkable(caret_rf_nosel$results, digits = 3, caption = \"Random Forest Model Performance with All Variable\")\n\n\n\nRandom Forest Model Performance with All Variable\n\n\nmtry\nRMSE\nRsquared\nMAE\nRMSESD\nRsquaredSD\nMAESD\n\n\n\n\n2\n11.574\n0.423\n8.514\n0.955\n0.099\n0.448\n\n\n14\n11.587\n0.424\n8.606\n1.005\n0.102\n0.447\n\n\n27\n11.608\n0.423\n8.654\n0.976\n0.100\n0.452\n\n\n\n\n\n\n\nCode\n# Ajouter une colonne pour identifier chaque modèle\nres_sel &lt;- caret_rf_model$results %&gt;%\n  mutate(Model = \"With Variable selection\")\n\nres_nosel &lt;- caret_rf_nosel$results %&gt;%\n  mutate(Model = \"With All Variables\")\n\n# Combiner les deux en un seul tableau\nres_combined &lt;- bind_rows(res_sel, res_nosel)\n\n# Passer au format long pour ggplot\nres_long &lt;- res_combined %&gt;%\n  select(mtry, RMSE, Rsquared, MAE, Model) %&gt;%\n  pivot_longer(cols = c(RMSE, Rsquared, MAE), names_to = \"Metric\", values_to = \"Value\")\n\n\n\n\nggplot(res_long, aes(x = mtry, y = Value, color = Model)) +\n  geom_line() +\n  geom_point(size = 2) +\n  facet_wrap(~ Metric, scales = \"free_y\") +\n  labs(\n    title = \"Comparison of performance by mtry\",\n    x = \"mtry (number of random variables)\",\n    y = \"Metric value\",\n    color = \"Model\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThe above graph presents a comparison of the performance of two Random Forest models based on three key metrics : MAE (Mean Absolute Error), RMSE (Root Mean Squared Error), and R² (coefficient of determination).\nThese metrics respectively evaluate the average absolute error, the root mean squared error, and the model’s ability to explain the variance of the observed data.\nWe observe that the model built with a prior selection of explanatory variables (model with variable selection) generally shows better performance compared to the model using all available variables (model with all variables) :\n\nThe MAE and RMSE values are lower, indicating more accurate predictions with smaller average differences between observed and predicted values.\nThe R² coefficient is higher, showing that the model with selection better explains the variability of carbon stocks (T_stock) in the data.\nThis improvement highlights the importance of reducing dimensionality and removing irrelevant or redundant variables, which allows the model to generalize better without overfitting.",
    "crumbs": [
      "Methods - Variable selection",
      "Comparison of Random forest models results"
    ]
  },
  {
    "objectID": "60_results.html",
    "href": "60_results.html",
    "title": "SOC stocks prediction",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(usdm)\nlibrary(exactextractr)\n\n\nPredictors must be at the same resolution (here the coarsest resolution: 1 km).\n\n\nCode\nchelsa &lt;- \n  list.files(\"data/download/CHELSA\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast()\nnames(chelsa) &lt;- list.files(\"data/download/CHELSA\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"CHELSA_|_1981-2010_V.2.1.tif\", replacement = \"\")\n\nsoilgrids &lt;- \n  list.files(\"data/download/ISRIC\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast() |&gt; \n  project(\"EPSG: 4326\") |&gt; \n  lapply(function(x) exact_resample(x, chelsa[[1]], 'mean')) |&gt; \n  rast()\nnames(soilgrids) &lt;- list.files(\"data/download/ISRIC\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"_mean.tif\", replacement = \"\")\n\nas.data.frame(chelsa, xy = TRUE) |&gt; \n  inner_join(as.data.frame(soilgrids, xy = TRUE)) |&gt; \n  write.csv(\"data/cache/data_vars.csv\", row.names = FALSE)\n\n\n\n\nCode\ndata &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\"))  %&gt;%\n  drop_na()\n\n# partition data in train/validation\n# randomly select 20% of sites for validation\nvalidation_sites &lt;- data %&gt;%\n  group_by(site) %&gt;%\n  summarise(type = c(\"cal\", \"val\")[1+rbinom(1, 1, 0.2)])\n\ndata &lt;- data %&gt;%\n  merge(validation_sites)\n\n\n\n\nCode\nrf_nosel &lt;- data |&gt; \n  select(!contains(\"plot\"), - site, -type, -lon, -lat, -T_stock) |&gt; \n  randomForest(\n    data$T_stock,\n    subset = (data$type == \"cal\"),\n    ntree=500,\n    importance=TRUE\n  )\n\n\n\n\nCode\ndata_vars &lt;- read.csv(\"data/cache/data_vars.csv\") |&gt; \n  drop_na()\ndata_vars$T_stock &lt;- predict(rf_nosel, data_vars)\n\nggplot(data_vars, aes(x, y, fill = T_stock)) +\n  geom_raster() +\n  coord_equal()+\n  labs(x = NULL, y = NULL) +\n  scale_fill_viridis_c(name = \"Stocks de C\\nprédits\\n(Mg/ha)\", option = \"D\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\nggsave(\"D:/projets-cirad/terri4sol/presentations/carte_c_preds.png\")\n\n\nSaving 7 x 5 in image",
    "crumbs": [
      "SOC stocks prediction"
    ]
  },
  {
    "objectID": "34_topography.html",
    "href": "34_topography.html",
    "title": "Topography",
    "section": "",
    "text": "Distribution of values in the t4s dataset\nElevation, slope, and aspect were derived from the Shuttle Radar Topography Mission (SRTM v3) digital elevation model (USGS SRTMGL1_003; 30 m resolution). Slope and aspect were computed from the original elevation data in Google Earth Engine, after which all bands were resampled to 100 m.\nTopographical Wetness Index (TWI) was calculated using the same SRTM source. First, the 30 m DEM was aggregated to 100 m using a mean reducer. Sinks in the resampled DEM were filled using the Fill Sinks (Wang and Liu 2006) algorithm implemented in the SAGA GIS library (minimum slope = 0°). The SAGA Wetness Index module was then used to compute TWI (parameters: Suction = 10; Area = Specific Catchment Area; Slope type = Catchment slope; Minimum slope = 0; Offset slope = 0.1; Slope weighting = 1).\nCode\nread.csv(\"data/cache/topo_data.csv\") |&gt;\n  pivot_longer(cols = c(\"elevation\", \"slope\", \"aspect\", \"twi\")) |&gt;\n  ggplot(aes(x = value)) +\n  geom_density() +\n  facet_wrap(~name, scales = \"free\") +\n  theme_classic() +\n  labs(x = NULL)\nCode\nread.csv(\"data/cache/topo_data.csv\") |&gt;\n  ggplot(aes(x = elevation, slope, col = site)) +\n  geom_point() +\n  scale_x_log10() +\n  scale_y_log10() +\n  theme_classic()\nCode\nread.csv(\"data/cache/topo_data.csv\") |&gt;\n  left_join(read.csv(\"data/plot_0.2.6.csv\")) |&gt;\n  filter(!is.na(toposequence) & toposequence != \"\") |&gt;\n  ggplot(aes(x = toposequence, y = slope)) +\n  geom_violin(fill = \"grey\") +\n  theme_classic()",
    "crumbs": [
      "Ancillary data",
      "Topography"
    ]
  },
  {
    "objectID": "35_landuse.html",
    "href": "35_landuse.html",
    "title": "Landuse data",
    "section": "",
    "text": "Comparison with landuse recorded in the t4s dataset\nWe used the 2020 land use map of Côte d’Ivoire produced by the Bureau National d’Études Techniques et de Développement (BNEDT).\nIn the table below we compare the landuse values recorded in the terri4sol database (columns) with the landuse values extracted from the BNEDT map at the same locations (rows).\nCode\nread.csv(\"data/cache/bnedt_data.csv\") |&gt;\n  left_join(read.csv(\"data/plot_0.2.6.csv\")) |&gt;\n  select(landuse, present_landuse) |&gt;\n  table()\n\n\n                                                           present_landuse\nlanduse                                                     cassava cocoa\n  Agricultural development/Other crops/Orchards/Fallow land      20    19\n  Cashew plantation                                               0     4\n  Cocoa Plantation                                                4    97\n  Coconut Plantation                                              0     1\n  Coffee Plantation                                               0     4\n  Dense forest                                                    1    18\n  Forest gallery                                                  1     0\n  Forest plantation/Reforestation                                 0     2\n  Fruit plantation / Arboriculture                                4    10\n  Light forest                                                    0     1\n  Oil palm plantation                                             1     7\n  Rubber plantation                                              10    56\n  Secondary forest/degraded forest                                4     6\n  Swamp forest/Forest on hydromorphic soil                        0     2\n  Tree savannah                                                   0     0\n                                                           present_landuse\nlanduse                                                     dist_for fallow\n  Agricultural development/Other crops/Orchards/Fallow land        0     13\n  Cashew plantation                                                0      0\n  Cocoa Plantation                                                 0     20\n  Coconut Plantation                                               0      0\n  Coffee Plantation                                                0      2\n  Dense forest                                                     2     36\n  Forest gallery                                                   0      4\n  Forest plantation/Reforestation                                  0     19\n  Fruit plantation / Arboriculture                                 0      4\n  Light forest                                                     0      3\n  Oil palm plantation                                              0      8\n  Rubber plantation                                                0     41\n  Secondary forest/degraded forest                                 0     10\n  Swamp forest/Forest on hydromorphic soil                         0      8\n  Tree savannah                                                    0     23\n                                                           present_landuse\nlanduse                                                     food_crop forest\n  Agricultural development/Other crops/Orchards/Fallow land         3      1\n  Cashew plantation                                                 0      0\n  Cocoa Plantation                                                  2      2\n  Coconut Plantation                                                0      0\n  Coffee Plantation                                                 0      0\n  Dense forest                                                      0      3\n  Forest gallery                                                    0      0\n  Forest plantation/Reforestation                                   1      3\n  Fruit plantation / Arboriculture                                  0      0\n  Light forest                                                      0      1\n  Oil palm plantation                                               1      1\n  Rubber plantation                                                 7      1\n  Secondary forest/degraded forest                                  2      0\n  Swamp forest/Forest on hydromorphic soil                          0      1\n  Tree savannah                                                     0      1\n                                                           present_landuse\nlanduse                                                     foretanc jvc palm\n  Agricultural development/Other crops/Orchards/Fallow land        0   0    3\n  Cashew plantation                                                0   0    0\n  Cocoa Plantation                                                 1   1    1\n  Coconut Plantation                                               0   0    0\n  Coffee Plantation                                                0   0    0\n  Dense forest                                                    11   6    0\n  Forest gallery                                                   2   0    0\n  Forest plantation/Reforestation                                  6   0    1\n  Fruit plantation / Arboriculture                                 0   0    0\n  Light forest                                                     1   0    0\n  Oil palm plantation                                              0   3    1\n  Rubber plantation                                                2  12    2\n  Secondary forest/degraded forest                                 0   1    0\n  Swamp forest/Forest on hydromorphic soil                         1   1    0\n  Tree savannah                                                    6   0    0\n                                                           present_landuse\nlanduse                                                     rubber sec_for\n  Agricultural development/Other crops/Orchards/Fallow land      1       0\n  Cashew plantation                                              0       0\n  Cocoa Plantation                                               2       0\n  Coconut Plantation                                             0       0\n  Coffee Plantation                                              0       0\n  Dense forest                                                   7       5\n  Forest gallery                                                 0       0\n  Forest plantation/Reforestation                                0       0\n  Fruit plantation / Arboriculture                               0       0\n  Light forest                                                   0       0\n  Oil palm plantation                                            4       0\n  Rubber plantation                                             16       0\n  Secondary forest/degraded forest                               1       0\n  Swamp forest/Forest on hydromorphic soil                       1       0\n  Tree savannah                                                  0       0\n                                                           present_landuse\nlanduse                                                     trees plantation\n  Agricultural development/Other crops/Orchards/Fallow land                0\n  Cashew plantation                                                        0\n  Cocoa Plantation                                                         0\n  Coconut Plantation                                                       0\n  Coffee Plantation                                                        0\n  Dense forest                                                             0\n  Forest gallery                                                           0\n  Forest plantation/Reforestation                                          5\n  Fruit plantation / Arboriculture                                         0\n  Light forest                                                             0\n  Oil palm plantation                                                      0\n  Rubber plantation                                                        0\n  Secondary forest/degraded forest                                         0\n  Swamp forest/Forest on hydromorphic soil                                 0\n  Tree savannah                                                            0",
    "crumbs": [
      "Ancillary data",
      "Landuse data"
    ]
  },
  {
    "objectID": "50_autocorrelation.html",
    "href": "50_autocorrelation.html",
    "title": "Methods - Spatial autocorrelation",
    "section": "",
    "text": "As the samples were grouped by sampling site, our dataset is spatially aggregated. Traditional random forest models do not account for the spatial structure of such data, particularly the presence of spatial autocorrelation. To address this issue, we evaluated the impact of incorporating spatial autocorrelation by using the Random Forest Spatial Interpolation (RFSI) approach (Sekulić et al. 2020). This approach was found to offer slightly improved performance while remaining computationally efficient in a separate national-scale study of soil organic carbon stock mapping (Kmoch et al. 2025).\n\n\n\n\nKmoch, Alexander, Clay Taylor Harrison, Jeonghwan Choi, and Evelyn Uuemaa. 2025. “Spatial Autocorrelation in Machine Learning for Modelling Soil Organic Carbon.” Ecological Informatics 86: 103057.\n\n\nSekulić, Aleksandar, Milan Kilibarda, Gerard BM Heuvelink, Mladen Nikolić, and Branislav Bajat. 2020. “Random Forest Spatial Interpolation.” Remote Sensing 12 (10): 1687.",
    "crumbs": [
      "Methods - Spatial autocorrelation"
    ]
  },
  {
    "objectID": "51_without_spat.html",
    "href": "51_without_spat.html",
    "title": "Without spatial autocorrelation",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(ranger)\n\n\n\n\nCode\ndata &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\")) %&gt;% \n  drop_na() \n\nrf_data &lt;- data %&gt;%\n  # partition data in train/validation\n  # randomly select 20% of sites for validation\n  group_by(site) %&gt;%\n  mutate(type = c(\"cal\", \"val\")[1+rbinom(1, 1, 0.2)])\n\n# write rf formula with previously selected variables\nformula_soc &lt;- read.csv(\"data/cache/var_selection.csv\") %&gt;%\n  filter(ffs2) %&gt;% select(variable) %&gt;% t() %&gt;%\n  paste(collapse = \" + \") %&gt;% paste(\"T_stock ~\", .) %&gt;%\n  as.formula()\n\nrf_model &lt;- ranger(formula = formula_soc, data = filter(rf_data, type == \"cal\"))\n\n\n\n\nCode\n# evaluate accuracy with validation data\npreds &lt;- data.frame(\n  id = seq_len(sum(rf_data$type == \"val\")),\n  obs = filter(rf_data, type == \"val\")$T_stock,\n  pred = predict(rf_model, filter(rf_data, type == \"val\"))$predictions\n)\n\n# Calculate RMSE and R²\nrmse_val &lt;- sqrt(sum((preds$obs-preds$pred)^2)/nrow(preds)) \nr2_val &lt;- cor(preds$obs, preds$pred)^2\n\ncat(\"RMSE:\", rmse_val, \"\\nR²:\", r2_val)\n\n\nRMSE: 11.78975 \nR²: 0.07043537",
    "crumbs": [
      "Methods - Spatial autocorrelation",
      "Without spatial autocorrelation"
    ]
  },
  {
    "objectID": "52_with_spat.html",
    "href": "52_with_spat.html",
    "title": "1  prepare data",
    "section": "",
    "text": "Without spatial predictors\nCode\nfun_model_ranger &lt;- function(df)  {\n  ranger(formula = formula_soc, data = df)\n}\nfun_pred_ranger &lt;- function(model, df1, df2) {\n  predict(model, df2)$predictions\n}\nkfold_ranger &lt;- kfold(data, \"T_stock\", \"site\", fun_model_ranger, fun_pred_ranger)\ncat(\"RMSE:\", kfold_ranger[1], \"\\nR²:\", kfold_ranger[2])\n\n\nRMSE: 34.13463 \nR²: -1.532094",
    "crumbs": [
      "Methods - Spatial autocorrelation",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>prepare data</span>"
    ]
  },
  {
    "objectID": "52_with_spat.html#with-spatial-predictors-rfsi",
    "href": "52_with_spat.html#with-spatial-predictors-rfsi",
    "title": "1  prepare data",
    "section": "With spatial predictors (RFSI)",
    "text": "With spatial predictors (RFSI)\n\n\nCode\nfun_model_rfsi &lt;- function(df)  {\n  df %&gt;%\n    st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;% \n    st_transform(2041) %&gt;% \n    rfsi(formula = formula_soc, data = .)\n}\nfun_pred_rfsi &lt;- function(model, df1, df2) {\n  df1 &lt;- df1 %&gt;%\n    st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;% \n    st_transform(2041)\n  df2 &lt;- df2 %&gt;%\n    st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;% \n    st_transform(2041)\n  pred.rfsi(model, data = df1, newdata = df2)$pred\n}\nkfold_rfsi &lt;- kfold(data, \"T_stock\", \"site\", fun_model_rfsi, fun_pred_rfsi)\ncat(\"RMSE:\", kfold_rfsi[1], \"\\nR²:\", kfold_rfsi[2])\n\n\nRMSE: 33.66783 \nR²: -0.7603123",
    "crumbs": [
      "Methods - Spatial autocorrelation",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>prepare data</span>"
    ]
  },
  {
    "objectID": "42_spatial_rf.html",
    "href": "42_spatial_rf.html",
    "title": "Spatial structure",
    "section": "",
    "text": "Non-spatial random forest\nAs the samples were grouped by sampling site, our dataset is spatially aggregated. Traditional random forest models do not account for the spatial structure of such data, particularly the presence of spatial autocorrelation. To address this issue, we evaluated the impact of incorporating spatial autocorrelation by using the Random Forest Spatial Interpolation (RFSI) approach (Sekulić et al. 2020). This approach was found to offer slightly improved performance while remaining computationally efficient in a separate national-scale study of soil organic carbon stock mapping (Kmoch et al. 2025).\nA Random Forest model was trained using the ranger package in R. The model was fitted with the response variable (soil organic carbon stock) and the complete set of predictor variables. Model accuracy metrics from the cross validation steps were:\nCode\nload(\"data/cache/models/rf_all.rda\")\ncat(\"RMSE:\", mean(rf_all$resample$RMSE), \n    \"\\nR²:\", mean(rf_all$resample$Rsquared))\n\n\nRMSE: 13.19634 \nR²: 0.07496982",
    "crumbs": [
      "Methodological choices",
      "Spatial structure"
    ]
  },
  {
    "objectID": "42_spatial_rf.html#random-forest-with-spatial-interpolation-rfsi",
    "href": "42_spatial_rf.html#random-forest-with-spatial-interpolation-rfsi",
    "title": "Spatial structure",
    "section": "Random Forest with Spatial Interpolation (RFSI)",
    "text": "Random Forest with Spatial Interpolation (RFSI)\nTo account for spatial autocorrelation, a Random Forest Spatial Interpolation (RFSI) model was implemented using the rfsi package. The RFSI model incorporates spatial neighborhood information into the Random Forest framework, allowing predictions that combine covariates with spatial proximity. Model accuracy metrics from the cross validation steps were:\n\n\nCode\ndata_sp &lt;- data_all %&gt;%\n  rename(staid = site) %&gt;% \n  st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;%\n  st_transform(2041)\nfun_model_rfsi &lt;- function(df)  {\n  df %&gt;%\n    st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;% \n    st_transform(2041) %&gt;% \n    rfsi(formula = formula_soc, data = .)\n}\nfun_pred_rfsi &lt;- function(model, df1, df2) {\n  df1 &lt;- df1 %&gt;%\n    st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;% \n    st_transform(2041)\n  df2 &lt;- df2 %&gt;%\n    st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;% \n    st_transform(2041)\n  pred.rfsi(model, data = df1, newdata = df2)$pred\n}\nkfold_rfsi &lt;- kfold(data_all, \"T_stock\", \"site\", fun_model_rfsi, fun_pred_rfsi)\ncat(\"RMSE:\", kfold_rfsi[1], \"\\nR²:\", kfold_rfsi[2])\n\n\nRMSE: 14.14108 \nR²: -0.03839664\n\n\n\n\n\n\nKmoch, Alexander, Clay Taylor Harrison, Jeonghwan Choi, and Evelyn Uuemaa. 2025. “Spatial Autocorrelation in Machine Learning for Modelling Soil Organic Carbon.” Ecological Informatics 86: 103057.\n\n\nSekulić, Aleksandar, Milan Kilibarda, Gerard BM Heuvelink, Mladen Nikolić, and Branislav Bajat. 2020. “Random Forest Spatial Interpolation.” Remote Sensing 12 (10): 1687.",
    "crumbs": [
      "Methodological choices",
      "Spatial structure"
    ]
  },
  {
    "objectID": "40_methodology.html",
    "href": "40_methodology.html",
    "title": "Methodological choices",
    "section": "",
    "text": "We tested different methodological choices: (i) adding a variable selection step to reduce the number of predictors; (ii) adding a spatially-explicit component.\nWe evaluated model performance using a leave-one-site-out cross-validation approach. The dataset was partitioned by sampling sites, such that all observations from a given site were withheld as the test set, while the remaining sites were used for model training. For each iteration, model predictions were compared to observed values in the test fold. Model accuracy was quantified using the root mean squared error (RMSE) and the coefficient of determination (R²), averaged across all validation folds.",
    "crumbs": [
      "Methodological choices"
    ]
  },
  {
    "objectID": "51_variable_effect.html",
    "href": "51_variable_effect.html",
    "title": "Effect of explanatory variables",
    "section": "",
    "text": "The importance of each selected variable in the final model is represented below.\n\n\nCode\nload(\"data/cache/models/qrf_final.rda\")\nbioclim_names &lt;- data.frame(\n  variable = paste0(\"bio\", 1:19),\n  var_name = c(\n  \"Annual Mean Temperature\", \"Mean Diurnal Range\", \"Isothermality\", \n  \"Temperature Seasonality\", \"Max Temperature of Warmest Month\", \n  \"Min Temperature of Coldest Month\", \"Temperature Annual Range\", \n  \"Mean Temperature of Wettest Quarter\", \"Mean Temperature of Driest Quarter\", \n  \"Mean Temperature of Warmest Quarter\", \"Mean Temperature of Coldest Quarter\", \n  \"Annual Precipitation\", \"Precipitation of Wettest Month\", \n  \"Precipitation of Driest Month\", \"Precipitation Seasonality\", \n  \"Precipitation of Wettest Quarter\", \"Precipitation of Driest Quarter\", \n  \"Precipitation of Warmest Quarter\", \"Precipitation of Coldest Quarter\")\n)\nimportance.qrf_llo(qrf_final, type = 1) |&gt;\n  left_join(bioclim_names) |&gt; \n  merge(read.csv(\"data/cache/var_selection.csv\")) |&gt;\n  mutate(variable = ifelse(is.na(var_name), variable, var_name)) |&gt;\n  ggplot(aes(x = reorder(variable, importance), y = importance, fill = group)) +\n  geom_bar(stat = \"identity\") +\n  coord_flip() +\n  xlab(\"Variables\") +\n  ylab(\"Increase in Node Purity\") +\n  theme_minimal()",
    "crumbs": [
      "Model results",
      "Effect of explanatory variables"
    ]
  },
  {
    "objectID": "52_soc_map.html",
    "href": "52_soc_map.html",
    "title": "SOC stocks prediction",
    "section": "",
    "text": "Predictors must be at the same resolution (here the coarsest resolution: 1 km).\n\n\nCode\nchelsa &lt;- list.files(\"data/download/CHELSA\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast()\nnames(chelsa) &lt;- list.files(\"data/download/CHELSA\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"CHELSA_|_1981-2010_V.2.1.tif\", replacement = \"\")\nsoilgrids &lt;- \n  list.files(\"data/download/ISRIC\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast() |&gt; \n  project(\"EPSG: 4326\")\nnames(soilgrids) &lt;- list.files(\"data/download/ISRIC\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"_mean.tif\", replacement = \"\") |&gt; \n  gsub(pattern = \"-\", replacement = \".\")\ntopography &lt;- list.files(\"data/download/SRTM/\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast() |&gt;\n  project(\"EPSG: 4326\")\nlandcover &lt;- list.files(\"data/download/BNEDT/\", pattern = \"tif$\", full.names = TRUE) |&gt;\n  rast() |&gt;\n  project(\"EPSG: 4326\")\nlevels(landcover) &lt;- read.csv(\"data/download/BNEDT/legend_bnedt.csv\") |&gt;\n  select(value, label) |&gt; rename(landuse = label)\n# resample to finest resolution - topography\n# for now: use coarsest resolution (chelsa)\ntopography &lt;- topography |&gt; \n  lapply(function(x) exact_resample(x, chelsa[[1]], 'mean')) |&gt; \n  rast()\nnames(topography) &lt;- list.files(\"data/download/SRTM\", pattern = \"tif$\", full.names = TRUE) |&gt; \n  rast() |&gt; names()\nsoilgrids &lt;- soilgrids |&gt; \n  lapply(function(x) exact_resample(x, chelsa[[1]], 'mean')) |&gt; \n  rast()\nnames(soilgrids) &lt;- list.files(\"data/download/ISRIC\", pattern = \"tif$\") |&gt; \n  gsub(pattern = \"_mean.tif\", replacement = \"\")\nlandcover &lt;- landcover |&gt; \n  lapply(function(x) exact_resample(x, chelsa[[1]], 'mode')) |&gt; \n  rast()\nnames(landcover) &lt;- \"landuse\"\ndata_vars &lt;- as.data.frame(chelsa, xy = TRUE) |&gt; \n  inner_join(as.data.frame(soilgrids, xy = TRUE)) |&gt; \n  inner_join(as.data.frame(topography, xy = TRUE)) |&gt; \n  inner_join(as.data.frame(landcover, xy = TRUE)) |&gt; \n  inner_join(read.csv(\"data/download/BNEDT/legend_bnedt.csv\"), by = join_by(landuse == value)) |&gt; \n  mutate(landuse = NULL, color = NULL) |&gt; rename(landuse = label) \n# model prediction\nload(\"data/cache/models/qrf_final.rda\")\npredict.qrf_llo(\n  qrf_final,\n  parallel = FALSE,\n  newdata = select(drop_na(data_vars), -x, -y)\n) |&gt; \n  bind_cols(select(drop_na(data_vars), x, y)) |&gt; \n  right_join(data_vars) |&gt;\n  write.csv(\"data/cache/data_vars.csv\", row.names = FALSE)\n\n\n\n\nCode\nread.csv(\"data/cache/data_vars.csv\") |&gt;\n  select(x, y, contains(\"Q\")) |&gt; \n  pivot_longer(cols = contains(\"Q\")) |&gt; \n  ggplot(aes(x, y, fill = value)) +\n  geom_raster() +\n  coord_equal() +\n  labs(x = NULL, y = NULL) +\n  facet_wrap(~name) + \n  scale_fill_viridis_c(name = \"Stocks de C\\nprédits\\n(Mg/ha)\", option = \"D\") +\n  theme_minimal()",
    "crumbs": [
      "Model results",
      "SOC stocks prediction"
    ]
  },
  {
    "objectID": "41_variable_selection.html#randomforest-with-variable-selection",
    "href": "41_variable_selection.html#randomforest-with-variable-selection",
    "title": "Variable selection",
    "section": "RandomForest with variable selection",
    "text": "RandomForest with variable selection\nThis method was inspired by the work from Traoré et al. (2024).\n\nEnvironmental variables were grouped as: climate - temperature / climate - precipitation / soil - physical variables / soil - chemical variables / topography / landuse.\nFor each group, a first variable selection was done to avoid collinearity, by applying a using a Variance Inflation Factor (VIF) threshold of &lt; 5 with a stepwise procedure (Naimi et al. 2014).\nA second variable selection step is then performed for each group of variables using a forward feature selection (FFS) procedure (Meyer et al. 2025).\nAll selected variables are then grouped, and the VIF + FFS are applied to this subset of variables.\nThe RandomForest model is then calibrated with the final subset of variables.\n\n\n\nCode\n# create groups\ndata_groups &lt;- data.frame(\n  variable = setdiff(colnames(data_all), c(\"site\", \"plot\", \"lon\", \"lat\", \"T_stock\"))\n) |&gt; \n  mutate(group = ifelse(variable %in% paste0(\"bio\", 1:11), \"clim-temp\", NA)) |&gt; \n  mutate(group = ifelse(variable %in% paste0(\"bio\", 12:19), \"clim-prec\", group)) |&gt; \n  mutate(group = ifelse(grepl(\"cec|nitrogen|phh2o\", variable), \"soil-chem\", group)) |&gt;\n  mutate(group = ifelse(grepl(\"bdod|cfvo|clay|sand|silt\", variable), \"soil-phys\", group)) |&gt; \n  mutate(group = ifelse(grepl(\"elevation|slope|aspect\", variable), \"topography\", group)) |&gt; \n  mutate(group = ifelse(grepl(\"landuse\", variable), \"landuse\", group)) |&gt;\n  group_by(group) |&gt; \n  # vif selection by group, based on variables selected at previous stage\n  mutate(vif1 = vif_select(variable, data_all)) |&gt; \n  # ffs by group, based on variables selected at previous stage\n  mutate(ffs1 = ffs_select(variable, data_all, vif1)) |&gt; \n  ungroup() |&gt; \n  # vif selection for all, based on variables selected at previous stage\n  mutate(vif2 = vif_select(variable, data_all, ffs1)) |&gt; \n  # ffs for all, based on variables selected at previous stage\n  mutate(ffs2 = ffs_select(variable, data_all, vif2))\nwrite.csv(data_groups, file = \"data/cache/var_selection.csv\", row.names = FALSE)\n\n\nThe following variables were selected for each group at the different steps:\n\n\nCode\nread.csv(\"data/cache/var_selection.csv\") |&gt; \n  pivot_longer(cols = paste0(rep(c(\"vif\", \"ffs\")), rep(1:2, each = 2))) |&gt; \n  group_by(group, name) |&gt; \n  summarise(vars = paste(variable[value], collapse = \", \")) |&gt; \n  pivot_wider(values_from = \"vars\") |&gt; \n  relocate(group, vif1, ffs1, vif2, ffs2) |&gt; \n  kable(col.names = c(\"Groups\", paste(rep(c(\"VIF\", \"FFS\")), \n                                      rep(c(\"group\", \"all\"), each = 2), \n                                      sep = \"_\")))\n\n\n\n\n\n\n\n\n\n\n\n\nGroups\nVIF_group\nFFS_group\nVIF_all\nFFS_all\n\n\n\n\nclim-prec\nbio14, bio15, bio18, bio19\nbio14, bio15, bio18, bio19\nbio15, bio18, bio19\nbio15, bio18\n\n\nclim-temp\nbio11, bio3, bio5, bio8, bio9\nbio11, bio5, bio8, bio9\nbio9\nbio9\n\n\nlanduse\nlanduse\nlanduse\nlanduse\nlanduse\n\n\nsoil-chem\ncec_0.5cm, nitrogen_0.5cm, phh2o_0.5cm\ncec_0.5cm, nitrogen_0.5cm, phh2o_0.5cm\ncec_0.5cm, nitrogen_0.5cm, phh2o_0.5cm\nphh2o_0.5cm\n\n\nsoil-phys\nbdod_0.5cm, cfvo_0.5cm, clay_0.5cm, silt_0.5cm\nbdod_0.5cm, cfvo_0.5cm, clay_0.5cm, silt_0.5cm\nbdod_0.5cm, cfvo_0.5cm, clay_0.5cm, silt_0.5cm\nbdod_0.5cm, silt_0.5cm\n\n\ntopography\nelevation, slope, aspect\nelevation, slope, aspect\nslope, aspect\naspect\n\n\n\n\n\nModel performance was evaluated with a leave-one-site-out cross-validation, which yielded the following metrics:\n\n\nCode\nformula_soc &lt;- read.csv(\"data/cache/var_selection.csv\") %&gt;%\n  filter(ffs2) %&gt;% select(variable) %&gt;% t() %&gt;%\n  paste(collapse = \" + \") %&gt;% paste(\"T_stock ~\", .) %&gt;%\n  as.formula()\nkfold_rf_sel &lt;- kfold(data_all, \"T_stock\", \"site\", fun_model_rf, fun_pred_rf)\ncat(\"RMSE:\", kfold_rf_sel[1], \"\\nR²:\", kfold_rf_sel[2])\n\n\nRMSE: 29.18929 \nR²: -1.021437",
    "crumbs": [
      "Methodological choices",
      "Variable selection"
    ]
  },
  {
    "objectID": "41_variable_selection.html#comparison-of-random-forest-models-results",
    "href": "41_variable_selection.html#comparison-of-random-forest-models-results",
    "title": "Variable selection",
    "section": "Comparison of Random forest models results",
    "text": "Comparison of Random forest models results\n\n\nCode\nrf_models &lt;- lapply(c(\"all\", \"vif\", \"ffs\"), function(model) {\n  load(paste0(\"data/cache/models/rf_\", model, \".rda\"))\n  get(paste0(\"rf_\", model))\n})\nnames(rf_models) &lt;- c(\"All Variables\", \"VIF selection\", \"VIF+FFS selection\")\nlapply(rf_models, function(md) md$results) %&gt;% \n  data.table::rbindlist(idcol=\"model\") %&gt;%\n  select(model, mtry, RMSE, Rsquared, MAE) %&gt;%\n  pivot_longer(cols = c(RMSE, Rsquared, MAE), \n               names_to = \"metric\", values_to = \"value\") |&gt; \n  ggplot(aes(x = mtry, y = value, color = model)) +\n  geom_line() +\n  geom_point(size = 2) +\n  facet_wrap(~ metric, scales = \"free_y\") +\n  labs(\n    title = \"Comparison of performance by mtry\",\n    x = \"mtry (number of variables sampled)\",\n    y = \"Metric value\",\n    color = \"Model\"\n  ) + theme_minimal()\n\n\n\n\n\n\n\n\n\n\n\n\n\nMeyer, Hanna, Carles Milà, Marvin Ludwig, Jan Linnenbrink, and Fabian Schumacher. 2025. CAST: ’Caret’ Applications for Spatial-Temporal Models. https://github.com/HannaMeyer/CAST.\n\n\nNaimi, Babak, Nicholas a.s. Hamm, Thomas A. Groen, Andrew K. Skidmore, and Albertus G. Toxopeus. 2014. “Where Is Positional Uncertainty a Problem for Species Distribution Modelling.” Ecography 37: 191–203. https://doi.org/10.1111/j.1600-0587.2013.00205.x.\n\n\nTraoré, Soulemane, Irie Casimir Zo-Bi, Camille Piponiot, Raphaël Aussenac, and Bruno Hérault. 2024. “Fragmentation is the main driver of residual forest aboveground biomass in West African low forest-high deforestation landscapes.” Trees, Forests and People 15 (March): 100477. https://doi.org/10.1016/j.tfp.2023.100477.",
    "crumbs": [
      "Methodological choices",
      "Variable selection"
    ]
  },
  {
    "objectID": "41_variable_selection.html#randomforest-with-variable-selection-based-on-vif",
    "href": "41_variable_selection.html#randomforest-with-variable-selection-based-on-vif",
    "title": "Variable selection",
    "section": "RandomForest with variable selection based on VIF",
    "text": "RandomForest with variable selection based on VIF\nVariable selection was done to avoid collinearity, by applying a using a Variance Inflation Factor (VIF) threshold of &lt; 5 with a stepwise procedure on all variables (Naimi et al. 2014).\n\n\nCode\n# create groups\ndata_groups_vif &lt;- data.frame(\n  variable = setdiff(colnames(data_all), c(\"site\", \"plot\", \"lon\", \"lat\", \"T_stock\"))\n) |&gt; # vif selection by group, based on variables selected at previous stage\n  mutate(vif = vif_select(variable, data_all))\nlist_vars &lt;- data_groups_vif |&gt; filter(vif) |&gt; select(variable) |&gt; \n  unlist() |&gt; paste(collapse = \"; \")\n\n\nThe variables kept were: bio18; bio19; bio3; bio9; bdod_0.5cm; cec_0.5cm; cfvo_0.5cm; clay_0.5cm; nitrogen_0.5cm; phh2o_0.5cm; silt_0.5cm; landuse; slope; aspect.\n\n\nCode\nformula_soc_vif &lt;- data_groups_vif %&gt;%\n  filter(vif) %&gt;% select(variable) %&gt;% t() %&gt;%\n  paste(collapse = \" + \") %&gt;% paste(\"T_stock ~\", .) %&gt;%\n  as.formula()\ntraining_index &lt;- lapply(unique(data_all$site), function(s) which(data_all$site != s))\nrf_vif &lt;- train(\n  form = formula_soc_vif,\n  data = data_all,\n  method = \"rf\",\n  metric = \"RMSE\",\n  trControl = trainControl(method = \"cv\", index = training_index),\n  ntree = 500, importance = TRUE\n)\nsave(rf_vif, file = \"data/cache/models/rf_vif.rda\")\n\n\nModel performance was evaluated with a leave-one-site-out cross-validation, which yielded the following metrics:\n\n\nRMSE: 14.05884 \nR²: 0.06594766",
    "crumbs": [
      "Methodological choices",
      "Variable selection"
    ]
  },
  {
    "objectID": "41_variable_selection.html#randomforest-with-variable-selection-based-on-vif-ffs",
    "href": "41_variable_selection.html#randomforest-with-variable-selection-based-on-vif-ffs",
    "title": "Variable selection",
    "section": "RandomForest with variable selection based on VIF + FFS",
    "text": "RandomForest with variable selection based on VIF + FFS\nThis method was inspired by the work from Traoré et al. (2024).\n\nEnvironmental variables were grouped as: climate - temperature / climate - precipitation / soil - physical variables / soil - chemical variables / topography / landuse.\nFor each group, a first variable selection was done to avoid collinearity, by applying a using a Variance Inflation Factor (VIF) threshold of &lt; 5 with a stepwise procedure (Naimi et al. 2014).\nA second variable selection step is then performed for each group of variables using a forward feature selection (FFS) procedure (Meyer et al. 2025).\nAll selected variables are then grouped, and the VIF + FFS are applied to this subset of variables.\nThe RandomForest model is then calibrated with the final subset of variables.\n\n\n\nCode\n# create groups\ndata_groups &lt;- data.frame(\n  variable = setdiff(colnames(data_all), c(\"site\", \"plot\", \"lon\", \"lat\", \"T_stock\"))\n) |&gt; \n  mutate(group = ifelse(variable %in% paste0(\"bio\", 1:11), \"clim-temp\", NA)) |&gt; \n  mutate(group = ifelse(variable %in% paste0(\"bio\", 12:19), \"clim-prec\", group)) |&gt; \n  mutate(group = ifelse(grepl(\"cec|nitrogen|phh2o\", variable), \"soil-chem\", group)) |&gt;\n  mutate(group = ifelse(grepl(\"bdod|cfvo|clay|sand|silt\", variable), \"soil-phys\", group)) |&gt; \n  mutate(group = ifelse(grepl(\"elevation|slope|aspect\", variable), \"topography\", group)) |&gt; \n  mutate(group = ifelse(grepl(\"landuse\", variable), \"landuse\", group)) |&gt;\n  group_by(group) |&gt; \n  # vif selection by group, based on variables selected at previous stage\n  mutate(vif1 = vif_select(variable, data_all)) |&gt; \n  # ffs by group, based on variables selected at previous stage\n  mutate(ffs1 = ffs_select(variable, data_all, vif1)) |&gt; \n  ungroup() |&gt; \n  # vif selection for all, based on variables selected at previous stage\n  mutate(vif2 = vif_select(variable, data_all, ffs1)) |&gt; \n  # ffs for all, based on variables selected at previous stage\n  mutate(ffs2 = ffs_select(variable, data_all, vif2))\nwrite.csv(data_groups, file = \"data/cache/var_selection.csv\", row.names = FALSE)\n\n\nThe following variables were selected for each group at the different steps:\n\n\nCode\nread.csv(\"data/cache/var_selection.csv\") |&gt; \n  pivot_longer(cols = paste0(rep(c(\"vif\", \"ffs\")), rep(1:2, each = 2))) |&gt; \n  group_by(group, name) |&gt; \n  summarise(vars = paste(variable[value], collapse = \", \")) |&gt; \n  pivot_wider(values_from = \"vars\") |&gt; \n  relocate(group, vif1, ffs1, vif2, ffs2) |&gt; \n  kable(col.names = c(\"Groups\", paste(rep(c(\"VIF\", \"FFS\")), \n                                      rep(c(\"group\", \"all\"), each = 2), \n                                      sep = \"_\")))\n\n\n\n\n\n\n\n\n\n\n\n\nGroups\nVIF_group\nFFS_group\nVIF_all\nFFS_all\n\n\n\n\nclim-prec\nbio14, bio15, bio18, bio19\nbio14, bio15, bio18, bio19\nbio15, bio18, bio19\nbio15, bio18\n\n\nclim-temp\nbio11, bio3, bio5, bio8, bio9\nbio11, bio5, bio8, bio9\nbio9\nbio9\n\n\nlanduse\nlanduse\nlanduse\nlanduse\nlanduse\n\n\nsoil-chem\ncec_0.5cm, nitrogen_0.5cm, phh2o_0.5cm\ncec_0.5cm, nitrogen_0.5cm, phh2o_0.5cm\ncec_0.5cm, nitrogen_0.5cm, phh2o_0.5cm\nphh2o_0.5cm\n\n\nsoil-phys\nbdod_0.5cm, cfvo_0.5cm, clay_0.5cm, silt_0.5cm\nbdod_0.5cm, cfvo_0.5cm, clay_0.5cm, silt_0.5cm\nbdod_0.5cm, cfvo_0.5cm, clay_0.5cm, silt_0.5cm\nbdod_0.5cm, silt_0.5cm\n\n\ntopography\nelevation, slope, aspect\nelevation, slope, aspect\nslope, aspect\naspect\n\n\n\n\n\n\n\nCode\nformula_soc_ffs &lt;- read.csv(\"data/cache/var_selection.csv\") %&gt;%\n  filter(ffs2) %&gt;% select(variable) %&gt;% t() %&gt;%\n  paste(collapse = \" + \") %&gt;% paste(\"T_stock ~\", .) %&gt;%\n  as.formula()\ntraining_index &lt;- lapply(unique(data_all$site), function(s) which(data_all$site != s))\nrf_ffs &lt;- train(\n  form = formula_soc_ffs,\n  data = data_all,\n  method = \"rf\",\n  metric = \"RMSE\",\n  trControl = trainControl(method = \"cv\", index = training_index),\n  ntree = 500, importance = TRUE\n)\nsave(rf_ffs, file = \"data/cache/models/rf_ffs.rda\")\n\n\nModel performance was evaluated with a leave-one-site-out cross-validation, which yielded the following metrics:\n\n\nRMSE: 13.84912 \nR²: 0.1056427",
    "crumbs": [
      "Methodological choices",
      "Variable selection"
    ]
  },
  {
    "objectID": "42_spatial_rf.html#randomforest-with-leave-one-site-out-cross-validation",
    "href": "42_spatial_rf.html#randomforest-with-leave-one-site-out-cross-validation",
    "title": "Spatial structure",
    "section": "RandomForest with Leave-One-Site-Out Cross Validation",
    "text": "RandomForest with Leave-One-Site-Out Cross Validation\n\n\nCode\ntraining_index &lt;- lapply(unique(data_all$site), function(s) which(data_all$site != s))\nrfSite &lt;- train(\n  form = formula_soc,\n  data = data_all,\n  method = \"ranger\",\n  metric = \"RMSE\",\n  trControl = trainControl(method = \"cv\", index = training_index),\n  ntree = 500\n)\ncat(\"RMSE:\", mean(rfSite$resample$RMSE), \n    \"\\nR²:\", mean(rfSite$resample$Rsquared))",
    "crumbs": [
      "Methodological choices",
      "Spatial structure"
    ]
  },
  {
    "objectID": "41_variable_selection.html#comparison-of-random-forest-models-performance",
    "href": "41_variable_selection.html#comparison-of-random-forest-models-performance",
    "title": "Variable selection",
    "section": "Comparison of Random forest models performance",
    "text": "Comparison of Random forest models performance\n\n\nCode\nrf_models &lt;- lapply(c(\"all\", \"vif\", \"ffs\"), function(model) {\n  load(paste0(\"data/cache/models/rf_\", model, \".rda\"))\n  get(paste0(\"rf_\", model))\n})\nnames(rf_models) &lt;- c(\"All Variables\", \"VIF selection\", \"VIF+FFS selection\")\nlapply(rf_models, function(md) md$results) %&gt;% \n  data.table::rbindlist(idcol=\"model\") %&gt;%\n  select(model, mtry, RMSE, Rsquared, MAE) %&gt;%\n  pivot_longer(cols = c(RMSE, Rsquared, MAE), \n               names_to = \"metric\", values_to = \"value\") |&gt; \n  ggplot(aes(x = mtry, y = value, color = model)) +\n  geom_line() +\n  geom_point(size = 2) +\n  facet_wrap(~ metric, scales = \"free_y\") +\n  labs(\n    title = \"Comparison of performance by mtry\",\n    x = \"mtry (number of variables sampled)\",\n    y = \"Metric value\",\n    color = \"Model\"\n  ) + theme_minimal()\n\n\n\n\n\n\n\n\n\n\n\n\n\nMeyer, Hanna, Carles Milà, Marvin Ludwig, Jan Linnenbrink, and Fabian Schumacher. 2025. CAST: ’Caret’ Applications for Spatial-Temporal Models. https://github.com/HannaMeyer/CAST.\n\n\nNaimi, Babak, Nicholas a.s. Hamm, Thomas A. Groen, Andrew K. Skidmore, and Albertus G. Toxopeus. 2014. “Where Is Positional Uncertainty a Problem for Species Distribution Modelling.” Ecography 37: 191–203. https://doi.org/10.1111/j.1600-0587.2013.00205.x.\n\n\nTraoré, Soulemane, Irie Casimir Zo-Bi, Camille Piponiot, Raphaël Aussenac, and Bruno Hérault. 2024. “Fragmentation is the main driver of residual forest aboveground biomass in West African low forest-high deforestation landscapes.” Trees, Forests and People 15 (March): 100477. https://doi.org/10.1016/j.tfp.2023.100477.",
    "crumbs": [
      "Methodological choices",
      "Variable selection"
    ]
  },
  {
    "objectID": "50_results.html",
    "href": "50_results.html",
    "title": "Model results",
    "section": "",
    "text": "Based on the tests in the “Methodological choices” section, we used the model with all variables and no spatial interpolation.\n\n\nCode\ndata_all &lt;- read.csv(\"data/cache/data_stocks.csv\") %&gt;% \n  merge(read.csv(\"data/cache/climate_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/soilgrids_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/bnedt_data.csv\")) %&gt;% \n  merge(read.csv(\"data/cache/srtm_data.csv\")) %&gt;% \n  drop_na() \nqrf_final &lt;- qrf_llo(\n  data = data_all,\n  ycol = \"T_stock\",\n  xcols = setdiff(colnames(data_all), c(\"site\", \"plot\", \"lon\", \"lat\", \"T_stock\")),\n  site = data_all$site,\n  nodesizes = c(5, 10, 15),\n  ntree = 200\n)\nsave(qrf_final, file = \"data/cache/models/qrf_final.rda\")",
    "crumbs": [
      "Model results"
    ]
  },
  {
    "objectID": "30_ancillary_data.html",
    "href": "30_ancillary_data.html",
    "title": "Ancillary data",
    "section": "",
    "text": "Code\nlibrary(stringr)\nlibrary(googledrive)\n\n\nWe compiled a suite of topographic, spectral, thermal, and climatic predictors from publicly available remote-sensing products and climate datasets. All variables were processed to a common spatial resolution of 100 m to ensure consistency among layers.",
    "crumbs": [
      "Ancillary data"
    ]
  },
  {
    "objectID": "30_ancillary_data.html#spectral-variables",
    "href": "30_ancillary_data.html#spectral-variables",
    "title": "Ancillary data",
    "section": "Spectral variables",
    "text": "Spectral variables\nWe obtained surface reflectance data from Sentinel-2, with native spatial resolutions of 10–20 m. Low-quality pixels (e.g., clouds, shadows) were removed using the quality assurance bands. Annual mean composites for 2024 were created for the 10 optical bands (Blue, Green, Red, NIR, four Red Edge bands, and two SWIR bands), which were subsequently resampled to 100 m.\nWe further computed the 2024 Normalized Difference Vegetation Index (NDVI) from the same Sentinel-2 source. After masking low-quality pixels, NDVI was calculated for each image, aggregated to an annual mean, and resampled to 100 m.",
    "crumbs": [
      "Ancillary data"
    ]
  },
  {
    "objectID": "30_ancillary_data.html#thermal-variable",
    "href": "30_ancillary_data.html#thermal-variable",
    "title": "Ancillary data",
    "section": "Thermal variable",
    "text": "Thermal variable\nLand surface temperature (LST) was obtained from the MODIS MOD11A1 v6.1 dataset (1 km native resolution). Low-quality observations were removed using MODIS quality flags, and a 2024 annual mean was calculated. The resulting composite was spatially upscaled to 100 m.\n\n\n\n\nWang, Lei, and Hongxing Liu. 2006. “An Efficient Method for Identifying and Filling Surface Depressions in Digital Elevation Models for Hydrologic Analysis and Modelling.” International Journal of Geographical Information Science 20 (2): 193–213.",
    "crumbs": [
      "Ancillary data"
    ]
  },
  {
    "objectID": "30_ancillary_data.html#climatic-variables",
    "href": "30_ancillary_data.html#climatic-variables",
    "title": "Ancillary data",
    "section": "Climatic variables",
    "text": "Climatic variables\nClimatic predictors were derived from the CHELSA Bioclim dataset (1981–2010 baseline; 1 km resolution). We used four bioclimatic variables: mean annual air temperature (bio01), maximum temperature of the warmest month (bio05), minimum temperature of the coldest month (bio06), and annual precipitation (bio12). All layers were resampled to 100 m.\n\n\n\n\nWang, Lei, and Hongxing Liu. 2006. “An Efficient Method for Identifying and Filling Surface Depressions in Digital Elevation Models for Hydrologic Analysis and Modelling.” International Journal of Geographical Information Science 20 (2): 193–213.",
    "crumbs": [
      "Ancillary data"
    ]
  },
  {
    "objectID": "32_spectral.html",
    "href": "32_spectral.html",
    "title": "Spectral variables",
    "section": "",
    "text": "Code\nlibrary(terra)\nlibrary(gdalUtilities)\nlibrary(tidyverse)\nlibrary(ggcorrplot)\nlibrary(ggfortify)\n\n\nWe obtained surface reflectance data from Sentinel-2, with native spatial resolutions of 10–20 m. Low-quality pixels (e.g., clouds, shadows) were removed using the quality assurance bands. Annual mean composites for 2024 were created for the 10 optical bands (Blue, Green, Red, NIR, four Red Edge bands, and two SWIR bands), which were subsequently resampled to 100 m.\nWe further computed the 2024 Normalized Difference Vegetation Index (NDVI) from the same Sentinel-2 source. After masking low-quality pixels, NDVI was calculated for each image, aggregated to an annual mean, and resampled to 100 m.\n\n\nCode\n# extract values for all t4s plots\ncoord_stocks &lt;- read.csv(\"data/cache/data_stocks.csv\") |&gt;\n  # project into EPSG:32630\n  vect(crs = \"epsg:4326\") |&gt;\n  terra::project(\"epsg:32630\")\n\nspectral_data &lt;- c(\n  \"data/01_Data/Environmental_variables/NDVI_Annual_Mean_2024_100m_CI.tif\",\n  \"data/01_Data/Environmental_variables/S2_Annual_Mean_2024_100m_CI.tif\"\n) |&gt;\n  rast() |&gt;\n  terra::extract(coord_stocks) |&gt;\n  select(-ID) |&gt;\n  bind_cols(select(as.data.frame(coord_stocks), \"site\", \"plot\")) |&gt;\n  relocate(site, plot)\nwrite.csv(spectral_data, file = \"data/cache/spectral_data.csv\",\n          row.names = FALSE)\n\n\nThe following plots have NAs in at least one Bioclim variable.\n\n\nCode\nspectral_data |&gt;\n  filter(if_any(everything(), is.na)) |&gt;\n  select(site, plot, NDVI, Blue_mean, Green_mean, Red_mean)\n\n\n     site plot NDVI Blue_mean Green_mean Red_mean\n1 adzopeN   15   NA        NA         NA       NA\n2 adzopeN   21   NA        NA         NA       NA\n3 adzopeN   48   NA        NA         NA       NA\n4 adzopeN   49   NA        NA         NA       NA\n5 adzopeN   50   NA        NA         NA       NA\n6 adzopeN   51   NA        NA         NA       NA\n7 adzopeN   68   NA        NA         NA       NA\n8 adzopeN   74   NA        NA         NA       NA\n\n\nBelow is the result of a Principal Component Analysis with all bioclimatic variables.\n\n\nCode\ndata_pca &lt;- spectral_data |&gt;\n  filter(!if_any(everything(), is.na))\n\ndata_pca |&gt;\n  select(-site, -plot) |&gt;\n  prcomp(scale = TRUE) |&gt;\n  autoplot(\n    loadings = TRUE, loadings.label = TRUE,\n    data = data_pca, colour = \"site\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nWe can also plot the pairwise correlation of all climate variables.\n\n\nCode\nspectral_data |&gt;\n  select(-site, -plot) |&gt;\n  drop_na() |&gt;\n  cor() |&gt;\n  ggcorrplot(type = \"upper\", lab = TRUE)\n\n\n\n\n\n\n\n\n\nWe could strongly reduce colinearity by reducing the number of variables.\n\n\nCode\nspectral_data |&gt;\n  select(NDVI, Blue_mean, Red_mean, NIR_mean) |&gt;\n  drop_na() |&gt;\n  cor() |&gt;\n  ggcorrplot(type = \"upper\", lab = TRUE)\n\n\n\n\n\n\n\n\n\nCode\nspectral_data |&gt;\n  filter(!if_any(everything(), is.na)) |&gt;\n  select(NDVI, Blue_mean, Red_mean, NIR_mean) |&gt;\n  prcomp(scale = TRUE) |&gt;\n  autoplot(\n    loadings = TRUE, loadings.label = TRUE,\n    data = data_pca, colour = \"site\"\n  ) +\n  theme_minimal()",
    "crumbs": [
      "Ancillary data",
      "Spectral variables"
    ]
  },
  {
    "objectID": "33_thermal.html",
    "href": "33_thermal.html",
    "title": "Thermal variable",
    "section": "",
    "text": "Code\nlibrary(terra)\nlibrary(gdalUtilities)\nlibrary(tidyverse)\nlibrary(ggcorrplot)\nlibrary(ggfortify)\n\n\nLand surface temperature (LST) was obtained from the MODIS MOD11A1 v6.1 dataset (1 km native resolution). Low-quality observations were removed using MODIS quality flags, and a 2024 annual mean was calculated. The resulting composite was spatially upscaled to 100 m.\n\n\nCode\nlst &lt;-\n  \"data/01_Data/Environmental_variables/LST_Annual_Mean_2024_100m_CI.tif\" |&gt;\n  rast()\nplot(lst)\n\n\n\n\n\n\n\n\n\n\n\nCode\n# extract values for all t4s plots\ncoord_stocks &lt;- read.csv(\"data/cache/data_stocks.csv\") |&gt;\n  # project into EPSG:32630\n  vect(crs = \"epsg:4326\") |&gt;\n  terra::project(\"epsg:32630\")\nthermal_data &lt;- lst |&gt;\n  terra::extract(coord_stocks) |&gt;\n  select(-ID) |&gt;\n  bind_cols(select(as.data.frame(coord_stocks), \"site\", \"plot\")) |&gt;\n  relocate(site, plot)\nwrite.csv(thermal_data, file = \"data/cache/thermal_data.csv\", row.names = FALSE)\n\n\nThe following plots have NAs in at least one Bioclim variable.\n\n\nCode\nthermal_data |&gt;\n  filter(if_any(everything(), is.na))\n\n\n     site plot Annual_Mean_LST\n1 adzopeN   15              NA\n2 adzopeN   21              NA\n3 adzopeN   48              NA\n4 adzopeN   49              NA\n5 adzopeN   50              NA\n6 adzopeN   51              NA\n7 adzopeN   68              NA\n8 adzopeN   74              NA",
    "crumbs": [
      "Ancillary data",
      "Thermal variable"
    ]
  },
  {
    "objectID": "34_topography.html#distribution-of-values-in-the-t4s-dataset",
    "href": "34_topography.html#distribution-of-values-in-the-t4s-dataset",
    "title": "Topography",
    "section": "",
    "text": "Wang, Lei, and Hongxing Liu. 2006. “An Efficient Method for Identifying and Filling Surface Depressions in Digital Elevation Models for Hydrologic Analysis and Modelling.” International Journal of Geographical Information Science 20 (2): 193–213.",
    "crumbs": [
      "Ancillary data",
      "Topography"
    ]
  },
  {
    "objectID": "36_tmf.html",
    "href": "36_tmf.html",
    "title": "TMF data",
    "section": "",
    "text": "Comparison of TMF and field-based plot classification\nWe used data from the Tropical Moist Forests (TMF) product, which is based on Landsat images (Vancutsem et al. 2021), to estimate the time since deforestation and the age of secondary forests. These classify tropical areas annually as follows: (i) undisturbed forests, (ii) disturbed forests, (iii) deforested areas, (iv) regrowing forests, (v) water, and (vi) other.\nWe estimated the age of secondary forests in 2022 as the number of years a pixel of regrowing forest in 2022 had continuously been classified as such. We estimated the time since deforestation as the time since a pixel that was classified as undisturbed or disturbed forest in 1990 (i.e. the first year of the TMF time series) had changed to another class.\nCode\ntmf2022 &lt;- rast(\"data/download/TMF/JRC_TMF_AnnualChange_v1_2022_RCI.tif\")\nplots &lt;- read.csv(\"data/plot_0.2.6.csv\")\nplots$tmf_class &lt;-\n  c(\"Undisturbed\", \"Degraded\", \"Deforested\", \"Regrowth\", \"Water\", \"Other\")[\n    terra::extract(tmf2022, plots[, c(\"lon\", \"lat\")])$Dec2022\n  ]\nplots |&gt;\n  with(table(tmf_class, present_landuse))\n\n\n             present_landuse\ntmf_class     cassava cocoa dist_for fallow food_crop forest foretanc jvc\n  Deforested       14    53        0     19         7      0        0   7\n  Degraded          3    43        1     60         0      4        5  12\n  Other            24    69        0     41         9      5        2   0\n  Regrowth          3    43        0     17         0      2        0   1\n  Undisturbed       1    19        6     22         0      3       14   4\n  Water             0     0        0      0         0      0        0   0\n             present_landuse\ntmf_class     old_mining others palm prim_for rubber sec_for trees plantation\n  Deforested           0      0    1        0      8       0                0\n  Degraded             4      0    0        1     14      52                0\n  Other                0      1    5        0      2       3                5\n  Regrowth             1      0    2        0      3      38                0\n  Undisturbed          3      0    0        6      5      22                0\n  Water                0      1    0        1      0       2                0",
    "crumbs": [
      "Ancillary data",
      "TMF data"
    ]
  },
  {
    "objectID": "36_tmf.html#comparison-of-tmf-and-field-based-plot-classification",
    "href": "36_tmf.html#comparison-of-tmf-and-field-based-plot-classification",
    "title": "TMF data",
    "section": "",
    "text": "Vancutsem, Christelle, Frédéric Achard, J-F Pekel, Ghislain Vieilledent, Silvia Carboni, Dario Simonetti, Javier Gallego, Luiz EOC Aragao, and Robert Nasi. 2021. “Long-Term (1990–2019) Monitoring of Forest Cover Changes in the Humid Tropics.” Science Advances 7 (10): eabe1603.",
    "crumbs": [
      "Ancillary data",
      "TMF data"
    ]
  }
]