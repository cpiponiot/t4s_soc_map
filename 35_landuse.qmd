```{r setup}
#| message: false
#| warning: false
library(terra)
library(tidyverse)
```

# Landuse data {.unnumbered}

We used the 2020 land use map of Côte d'Ivoire produced by the Bureau National d'Études Techniques et de Développement (BNEDT).

```{r}
#| message: false
#| warning: false
legend <- read.csv("data/download/BNEDT/legend_bnedt.csv")
list.files("data/download/BNEDT/", pattern = "tif$", full.names = TRUE) |>
rast() |> plot(col = legend$color)
```

```{r}
#| message: false
#| warning: false
#| fig.height: 4
#| fig.width: 12
plot(ceiling(legend$value/12), 12*ceiling(legend$value/12)-legend$value, 
     col = legend$col, cex = 2, pch=16, xlim = c(1,3), 
     xlab=NA, ylab = NA, xaxt = "n", yaxt = "n")
text(ceiling(legend$value/12)+0.5, 12*ceiling(legend$value/12)-legend$value,
     legend$label)
```

```{r}
#| message: false
#| warning: false
#| eval: false
plot_coords <- read.csv("data/plot_0.2.4.csv") |> 
  filter(!is.na(lon)) |>
  vect(geom=c("lon", "lat"), crs = "EPSG:4326") |> 
  project("EPSG:32630") |> 
  as.data.frame(geom = "XY")
list.files("data/download/BNEDT/", pattern = "tif$", full.names = TRUE) |> 
  rast() |> 
  terra::extract(plot_coords[, c("x", "y")]) |>
  bind_cols(plot_coords) |>
  select(-ID) |>
  left_join(read.csv("data/download/BNEDT/legend_bnedt.csv"), 
            by = join_by(BNEDT_OCS_2020.tif==value)) |>
  rename(landuse = label) |>
  select(site, plot, landuse) |> 
  write.csv("data/cache/bnedt_data.csv", row.names = FALSE)
```

## Comparison with landuse recorded in the t4s dataset

In the table below we compare the landuse values recorded in the terri4sol database (columns) with the landuse values extracted from the BNEDT map at the same locations (rows).

```{r}
#| message: false
#| warning: false
read.csv("data/cache/bnedt_data.csv") |> 
  left_join(read.csv("data/plot_0.2.4.csv")) |> 
  select(landuse, present_landuse) |> 
  table()
```
